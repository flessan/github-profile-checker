<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Profile Analyzer - Enhanced Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* --- Base & Variables --- */
        :root {
            --color-canvas-default: #ffffff;
            --color-canvas-subtle: #f6f8fa;
            --color-border-default: #d0d7de;
            --color-border-muted: #d8dee4;
            --color-fg-default: #1f2328;
            --color-fg-muted: #656d76;
            --color-fg-subtle: #6e7781;
            --color-accent-fg: #0969da;
            --color-accent-emphasis: #0969da;
            --color-success-fg: #1a7f37;
            --color-danger-fg: #d1242f;
            --color-attention-fg: #9a6700;
            --color-done-fg: #8250df;
            --color-btn-bg: #f6f8fa;
            --color-btn-border: #d0d7de;
            --color-btn-text: #24292f;
            --color-btn-primary-bg: #1f883d;
            --color-btn-primary-border: rgba(27,31,36,.15);
            --color-btn-primary-text: #fff;
            --color-btn-hover-bg: #f3f4f6;
            --color-btn-primary-hover-bg: #1c7e38;
            --color-header-bg: #f6f8fa;
            --color-header-text: var(--color-fg-default);
            --shadow-small: 0 1px 2px rgba(31,35,40,0.04), 0 1px 0px rgba(31,35,40,0.02);
            --shadow-medium: 0 3px 6px rgba(140,149,159,0.15);
            --shadow-large: 0 8px 24px rgba(140,149,159,0.2);
            --contrib-level-0: #ebedf0;
            --contrib-level-1: #9be9a8;
            --contrib-level-2: #40c463;
            --contrib-level-3: #30a14e;
            --contrib-level-4: #216e39;
            --transition-base: all 0.2s ease;
            --transition-extended: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 8px;
            --border-radius-small: 6px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--color-fg-default);
            background-color: var(--color-canvas-default);
            margin: 0;
            display: flex;
            justify-content: center;
            transition: var(--transition-base);
            overflow-x: hidden;
        }

        body.dark-mode {
            --color-canvas-default: #0d1117;
            --color-canvas-subtle: #161b22;
            --color-border-default: #30363d;
            --color-border-muted: #21262d;
            --color-fg-default: #f0f6fc;
            --color-fg-muted: #7d8590;
            --color-fg-subtle: #656d76;
            --color-accent-fg: #2f81f7;
            --color-accent-emphasis: #1f6feb;
            --color-btn-bg: #21262d;
            --color-btn-border: #30363d;
            --color-btn-text: #c9d1d9;
            --color-btn-hover-bg: #30363d;
            --color-header-bg: #161b22;
            --color-header-text: #f0f6fc;
            --shadow-small: 0 0 transparent;
            --shadow-medium: 0 0 transparent;
            --shadow-large: 0 0 transparent;
            --contrib-level-0: #161b22;
            --contrib-level-1: #0e4429;
            --contrib-level-2: #006d32;
            --contrib-level-3: #26a641;
            --contrib-level-4: #39d353;
        }

        /* --- Layout --- */
        .application-container {
            width: 100%;
            max-width: 1280px;
            padding: var(--spacing-md);
            position: relative;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .card {
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-small);
            transition: var(--transition-extended);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        /* --- Header --- */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            position: relative;
        }

        .app-header h1 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.5px;
            color: var(--color-header-text);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .app-header h1 i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--color-fg-default);
            font-size: 18px;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            transition: var(--transition-base);
            position: relative;
        }

        .icon-btn:hover {
            background-color: var(--color-btn-hover-bg);
        }

        .notification-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background-color: var(--color-danger-fg);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Search Section --- */
        .search-compare-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }
        .search-bar {
            display: flex;
            flex-grow: 1;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius);
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-default);
            transition: var(--transition-base);
        }
        .search-bar input:focus {
            outline: none;
            border-color: var(--color-accent-fg);
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.2);
        }
        .search-bar button {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-fg-muted);
            cursor: pointer;
            font-size: 18px;
        }
        .compare-toggle button, .ai-suggestions button, .trending-toggle button {
            padding: 10px 16px;
            border: 1px solid var(--color-border-default);
            background-color: var(--color-btn-bg);
            color: var(--color-fg-default);
            border-radius: var(--border-radius-small);
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        .compare-toggle button:hover, .ai-suggestions button:hover, .trending-toggle button:hover {
            background-color: var(--color-btn-hover-bg);
            transform: translateY(-2px);
        }
        .compare-section {
            margin-top: var(--spacing-md);
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-history {
            margin-top: var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        .history-item {
            padding: 6px 12px;
            background-color: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        .history-item:hover {
            background-color: var(--color-btn-hover-bg);
            transform: translateY(-2px);
        }
        .history-item i {
            font-size: 10px;
        }

        /* --- Profile Header --- */
        .profile-header {
            display: flex;
            gap: var(--spacing-md);
            flex-direction: row;
            flex-wrap: wrap;
            position: relative;
        }
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--color-border-muted);
            transition: var(--transition-extended);
            position: relative;
            overflow: hidden;
        }
        .profile-avatar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-accent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-medium);
        }
        .profile-avatar:hover::after {
            opacity: 0.2;
        }
        .profile-info h1 {
            font-size: 26px;
            font-weight: 600;
            margin: 0 0 4px;
            padding: 0;
        }
        .profile-info #login {
            font-size: 20px;
            font-weight: 300;
            color: var(--color-fg-muted);
            margin: 0 0 var(--spacing-md);
        }
        .profile-info #bio {
            font-size: 16px;
            margin-bottom: var(--spacing-md);
        }
        .profile-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 14px;
            color: var(--color-fg-muted);
            margin-bottom: var(--spacing-md);
        }
        .profile-meta span i {
            margin-right: 5px;
        }
        .profile-meta a {
            color: var(--color-accent-fg);
            text-decoration: none;
        }
        .profile-meta a:hover {
            text-decoration: underline;
        }
        .profile-stats {
            display: flex;
            gap: var(--spacing-md);
            font-size: 14px;
            margin-bottom: var(--spacing-md);
        }
        .profile-stats strong {
            color: var(--color-fg-default);
        }
        .btn {
            display: inline-block;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            line-height: 20px;
            color: var(--color-btn-text);
            background-color: var(--color-btn-bg);
            border: 1px solid var(--color-btn-border);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition-base);
            margin-right: var(--spacing-sm);
        }
        .btn:hover {
            background-color: var(--color-btn-hover-bg);
            transform: translateY(-2px);
        }
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
        }
        .btn-primary:hover {
            background: var(--gradient-secondary);
        }
        .export-btn {
            margin-left: var(--spacing-sm);
        }

        /* --- Tab Navigation --- */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--color-border-default);
            padding: 0;
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
            position: relative;
        }
        .tab-nav::after {
            content: '';
            position: absolute;
            bottom: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: var(--transition-extended);
        }
        .tab-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            line-height: 30px;
            color: var(--color-fg-muted);
            text-decoration: none;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            transition: var(--transition-base);
            position: relative;
        }
        .tab-item:hover {
            color: var(--color-fg-default);
        }
        .tab-item.active {
            color: var(--color-accent-fg);
            border-bottom-color: var(--color-accent-fg);
        }
        .tab-item i {
            margin-right: var(--spacing-xs);
        }
        .Counter {
            margin-left: 5px;
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-default);
            padding: 2px 5px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 2em;
            min-width: 20px;
            text-align: center;
        }

        /* --- Tab Content --- */
        .tab-pane {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .tab-pane.active {
            display: block;
        }
        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }
        @media (min-width: 768px) {
            .content-grid {
                grid-template-columns: 2fr 1fr;
            }
        }
        .pinned-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }
        .pinned-item {
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
            padding: var(--spacing-md);
            transition: var(--transition-extended);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .pinned-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        .pinned-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }
        .pinned-item:hover::before {
            transform: scaleX(1);
        }
        .pinned-item h3 {
            font-size: 16px;
            margin-bottom: var(--spacing-sm);
        }
        .pinned-item h3 a {
            color: var(--color-accent-fg);
            text-decoration: none;
        }
        .pinned-item h3 a:hover {
            text-decoration: underline;
        }
        .pinned-item p {
            font-size: 12px;
            color: var(--color-fg-muted);
            margin-bottom: var(--spacing-md);
        }
        .pinned-item .repo-stats {
            font-size: 12px;
            color: var(--color-fg-muted);
        }
        .language-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        /* --- Contribution Graph --- */
        .contribution-graph {
            display: grid;
            grid-template-columns: repeat(53, 1fr);
            gap: 2px;
            margin-top: var(--spacing-md);
        }
        .contribution-day {
            width: 11px;
            height: 11px;
            border-radius: 2px;
            background-color: var(--contrib-level-0);
            position: relative;
            transition: var(--transition-base);
        }
        .contribution-day:hover {
            outline: 2px solid var(--color-border-default);
            outline-offset: 1px;
            transform: scale(1.2);
        }
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
            padding: 5px 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            box-shadow: var(--shadow-medium);
            display: none;
        }
        .contribution-day:hover .tooltip {
            display: block;
        }

        /* --- Language Chart --- */
        .language-chart {
            margin-top: var(--spacing-md);
        }
        .language-bar {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        .language-bar-name {
            width: 100px;
            font-size: 12px;
        }
        .language-bar-container {
            flex-grow: 1;
            height: 8px;
            background-color: var(--color-canvas-subtle);
            border-radius: 4px;
            overflow: hidden;
        }
        .language-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }
        .language-bar-percent {
            margin-left: var(--spacing-sm);
            font-size: 12px;
            font-weight: 600;
        }

        /* --- Repositories --- */
        .repo-controls, .starred-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }
        .control-group {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        .control-group input, .control-group select {
            padding: 8px 12px;
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-default);
            transition: var(--transition-base);
        }
        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: var(--color-accent-fg);
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.2);
        }
        .view-toggle {
            display: flex;
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
        }
        .view-btn {
            padding: 8px 12px;
            background: none;
            border: none;
            color: var(--color-fg-muted);
            cursor: pointer;
            transition: var(--transition-base);
        }
        .view-btn:first-child {
            border-right: 1px solid var(--color-border-default);
        }
        .view-btn.active {
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-default);
        }
        .repo-list-container, .starred-list-container {
            margin-top: var(--spacing-md);
        }
        .repo-list-container.list-view, .starred-list-container.list-view {
            display: flex;
            flex-direction: column;
            border-top: 1px solid var(--color-border-default);
        }
        .repo-list-container.grid-view, .starred-list-container.grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-md);
        }
        .repo-item, .starred-item {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-border-default);
            cursor: pointer;
            transition: var(--transition-base);
            position: relative;
        }
        .repo-item:hover, .starred-item:hover {
            background-color: var(--color-canvas-subtle);
        }
        .repo-item:last-child, .starred-item:last-child {
            border-bottom: none;
        }
        .repo-item h3, .starred-item h3 {
            font-size: 16px;
            margin: 0 0 var(--spacing-xs);
        }
        .repo-item h3 a, .starred-item h3 a {
            color: var(--color-accent-fg);
            text-decoration: none;
        }
        .repo-item h3 a:hover, .starred-item h3 a:hover {
            text-decoration: underline;
        }
        .repo-item p, .starred-item p {
            color: var(--color-fg-muted);
            margin-bottom: var(--spacing-sm);
        }
        .repo-item-stats, .starred-item-stats {
            font-size: 12px;
            color: var(--color-fg-muted);
        }
        .repo-item-stats span, .starred-item-stats span {
            margin-right: var(--spacing-md);
        }

        /* --- Pagination --- */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: var(--spacing-md);
        }
        .pagination-container button {
            margin: 0 4px;
            padding: 8px 12px;
            border: 1px solid var(--color-border-default);
            background-color: var(--color-btn-bg);
            color: var(--color-fg-default);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: var(--transition-base);
        }
        .pagination-container button:hover {
            background-color: var(--color-btn-hover-bg);
        }
        .pagination-container button.active {
            background-color: var(--color-accent-emphasis);
            color: white;
            border-color: var(--color-accent-emphasis);
        }

        /* --- Activity --- */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border-default);
            transition: var(--transition-base);
        }
        .activity-item:hover {
            background-color: var(--color-canvas-subtle);
            padding-left: var(--spacing-sm);
            padding-right: var(--spacing-sm);
            margin-left: calc(-1 * var(--spacing-sm));
            margin-right: calc(-1 * var(--spacing-sm));
            padding-top: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-radius: var(--border-radius-small);
        }
        .activity-item:last-child {
            border-bottom: none;
        }
        .activity-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-muted);
            flex-shrink: 0;
        }
        .activity-content {
            flex-grow: 1;
        }
        .activity-time {
            font-size: 12px;
            color: var(--color-fg-muted);
        }

        /* --- AI Insights --- */
        .ai-suggestions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: var(--spacing-md);
        }
        .ai-input-container {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }
        .ai-input-container input {
            flex-grow: 1;
            padding: 10px 12px;
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
            background-color: var(--color-canvas-subtle);
            color: var(--color-fg-default);
            transition: var(--transition-base);
        }
        .ai-input-container input:focus {
            outline: none;
            border-color: var(--color-accent-fg);
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.2);
        }
        .ai-response {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
            line-height: 1.5;
            font-size: 14px;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        .ai-response h1, .ai-response h2, .ai-response h3 { margin-top: 1em; margin-bottom: 0.5em; }
        .ai-response ul { padding-left: 20px; }
        .ai-response strong { font-weight: 600; }

        /* --- Comparison --- */
        .comparison-results {
            margin-top: var(--spacing-md);
        }
        .comparison-results table {
            width: 100%;
            border-collapse: collapse;
        }
        .comparison-results th, .comparison-results td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border-default);
        }
        .comparison-results th {
            background-color: var(--color-canvas-subtle);
            font-weight: 600;
        }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            background-color: var(--color-canvas-default);
            margin: 5% auto;
            padding: 0;
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-large);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-border-default);
        }
        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }
        .modal-close-btn {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-fg-muted);
            background: none;
            border: none;
            cursor: pointer;
            transition: var(--transition-base);
        }
        .modal-close-btn:hover {
            color: var(--color-fg-default);
        }
        #readme-body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            flex-grow: 1;
        }

        /* --- Basic Markdown Styling for README --- */
        .markdown-body h1, .markdown-body h2, .markdown-body h3 { 
            margin-top: var(--spacing-lg); 
            margin-bottom: var(--spacing-md); 
            font-weight: 600; 
            line-height: 1.25; 
            border-bottom: 1px solid var(--color-border-muted); 
            padding-bottom: 0.3em; 
        }
        .markdown-body h1 { font-size: 2em; }
        .markdown-body h2 { font-size: 1.5em; }
        .markdown-body h3 { font-size: 1.25em; border-bottom: none; }
        .markdown-body p { margin-bottom: var(--spacing-md); }
        .markdown-body code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(175,184,193,0.2);
            border-radius: var(--border-radius-small);
        }
        .markdown-body pre {
            padding: var(--spacing-md);
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: var(--color-canvas-subtle);
            border-radius: var(--border-radius-small);
            margin-bottom: var(--spacing-md);
        }
        .markdown-body pre code {
            display: inline;
            max-width: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0;
        }
        .markdown-body ul, .markdown-body ol { padding-left: 2em; margin-bottom: var(--spacing-md); }
        .markdown-body a { color: var(--color-accent-fg); text-decoration: none; }
        .markdown-body a:hover { text-decoration: underline; }
        .markdown-body table { 
            border-spacing: 0; 
            border-collapse: collapse; 
            margin-bottom: var(--spacing-md); 
            width: 100%; 
        }
        .markdown-body table th, .markdown-body table td { 
            padding: 6px 13px; 
            border: 1px solid var(--color-border-default); 
        }
        .markdown-body table th { 
            background-color: var(--color-canvas-subtle); 
            font-weight: 600; 
        }

        /* --- Repository Health --- */
        .health-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }
        .health-metric {
            text-align: center;
            padding: var(--spacing-md);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
            transition: var(--transition-extended);
        }
        .health-metric:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }
        .health-metric-value {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        .health-metric-label {
            font-size: 12px;
            color: var(--color-fg-muted);
        }
        .health-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-top: var(--spacing-sm);
        }
        .health-status.good {
            background-color: rgba(26, 127, 55, 0.1);
            color: var(--color-success-fg);
        }
        .health-status.moderate {
            background-color: rgba(154, 103, 0, 0.1);
            color: var(--color-attention-fg);
        }
        .health-status.poor {
            background-color: rgba(210, 36, 47, 0.1);
            color: var(--color-danger-fg);
        }

        /* --- Contribution Streak --- */
        .streak-container {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-small);
        }
        .streak-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }
        .streak-value {
            font-size: 24px;
            font-weight: 600;
        }
        .streak-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .streak-day {
            height: 20px;
            background-color: var(--color-canvas-subtle);
            border-radius: 2px;
            transition: var(--transition-base);
        }
        .streak-day.active {
            background-color: var(--color-success-fg);
        }
        .streak-day:hover {
            transform: scale(1.2);
        }

        /* --- Activity Heatmap --- */
        .activity-heatmap {
            margin-top: var(--spacing-md);
        }
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            margin-top: var(--spacing-md);
        }
        .heatmap-hour {
            height: 20px;
            background-color: var(--color-canvas-subtle);
            border-radius: 2px;
            transition: var(--transition-base);
        }
        .heatmap-hour:hover {
            transform: scale(1.2);
        }
        .heatmap-legend {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-sm);
            font-size: 12px;
            color: var(--color-fg-muted);
        }

        /* --- Follower Growth --- */
        .growth-chart {
            margin-top: var(--spacing-md);
            height: 200px;
            position: relative;
        }
        .growth-canvas {
            width: 100%;
            height: 100%;
        }

        /* --- Export Options --- */
        .export-options {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        /* --- Utility --- */
        .loading-container {
            text-align: center;
            padding: var(--spacing-xl);
            display: none;
        }
        .spinner {
            border: 3px solid var(--color-border-muted);
            border-top: 3px solid var(--color-accent-emphasis);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-md);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-container {
            color: var(--color-danger-fg);
            background-color: rgba(210, 36, 47, 0.1);
            border: 1px solid rgba(210, 36, 47, 0.3);
            border-radius: var(--border-radius-small);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            display: none;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* --- New Features Styling --- */
        
        /* Skills Radar Chart */
        .skills-radar {
            margin-top: var(--spacing-md);
            height: 300px;
            position: relative;
        }
        
        /* Project Timeline */
        .timeline-container {
            margin-top: var(--spacing-md);
            position: relative;
            padding-left: 30px;
        }
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gradient-primary);
        }
        .timeline-item {
            position: relative;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-small);
            background-color: var(--color-canvas-subtle);
            transition: var(--transition-base);
        }
        .timeline-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-medium);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--color-accent-emphasis);
            border: 2px solid var(--color-canvas-default);
        }
        .timeline-date {
            font-size: 12px;
            color: var(--color-fg-muted);
            margin-bottom: var(--spacing-xs);
        }
        .timeline-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }
        .timeline-description {
            font-size: 14px;
            color: var(--color-fg-muted);
        }
        
        /* Collaboration Network */
        .network-container {
            margin-top: var(--spacing-md);
            height: 400px;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius-small);
            background-color: var(--color-canvas-subtle);
        }
        
        /* Trending Section */
        .trending-container {
            margin-top: var(--spacing-md);
        }
        .trending-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--color-border-default);
            transition: var(--transition-base);
        }
        .trending-item:hover {
            background-color: var(--color-canvas-subtle);
        }
        .trending-item:last-child {
            border-bottom: none;
        }
        .trending-rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-accent-emphasis);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            margin-right: var(--spacing-md);
        }
        .trending-info {
            flex-grow: 1;
        }
        .trending-name {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }
        .trending-stats {
            font-size: 12px;
            color: var(--color-fg-muted);
        }
        
        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }
        .notification {
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            box-shadow: var(--shadow-large);
            animation: slideInRight 0.3s ease-out;
            display: flex;
            align-items: center;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .notification-icon {
            margin-right: var(--spacing-sm);
            font-size: 18px;
        }
        .notification-content {
            flex-grow: 1;
        }
        .notification-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }
        .notification-message {
            font-size: 12px;
            color: var(--color-fg-muted);
        }
        .notification-close {
            margin-left: var(--spacing-sm);
            cursor: pointer;
            color: var(--color-fg-muted);
        }
        
        /* Achievement Badges */
        .achievements-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }
        .achievement {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100px;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            background-color: var(--color-canvas-subtle);
            transition: var(--transition-base);
        }
        .achievement:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .achievement-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
            color: var(--color-accent-emphasis);
        }
        .achievement-name {
            font-size: 12px;
            text-align: center;
            font-weight: 600;
        }
        .achievement-description {
            font-size: 10px;
            text-align: center;
            color: var(--color-fg-muted);
            margin-top: var(--spacing-xs);
        }
        
        /* Productivity Score */
        .productivity-score {
            margin-top: var(--spacing-md);
            text-align: center;
        }
        .score-circle {
            width: 150px;
            height: 150px;
            margin: 0 auto var(--spacing-md);
            position: relative;
        }
        .score-circle svg {
            transform: rotate(-90deg);
        }
        .score-circle-bg {
            fill: none;
            stroke: var(--color-canvas-subtle);
            stroke-width: 10;
        }
        .score-circle-progress {
            fill: none;
            stroke: var(--color-accent-emphasis);
            stroke-width: 10;
            stroke-linecap: round;
            stroke-dasharray: 440;
            stroke-dashoffset: 440;
            transition: stroke-dashoffset 1s ease-out;
        }
        .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: 600;
        }
        .score-label {
            font-size: 14px;
            color: var(--color-fg-muted);
        }
        .score-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }
        .score-factor {
            text-align: center;
        }
        .factor-value {
            font-size: 18px;
            font-weight: 600;
        }
        .factor-label {
            font-size: 12px;
            color: var(--color-fg-muted);
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .application-container {
                padding: var(--spacing-sm);
            }
            
            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .profile-meta {
                justify-content: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
            
            .tab-nav {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .repo-controls, .starred-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .comparison-results table {
                font-size: 12px;
            }
            
            .comparison-results th, .comparison-results td {
                padding: 4px 8px;
            }
            
            .notification-container {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="application-container">
        <header class="app-header">
            <h1><i class="fab fa-github"></i> GitHub Profile Analyzer</h1>
            <div class="header-actions">
                <button id="notification-btn" class="icon-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge"></span>
                </button>
                <button id="theme-toggle" class="icon-btn" title="Toggle dark mode"><i class="fas fa-moon"></i></button>
            </div>
        </header>

        <main class="main-content">
            <div class="search-section card">
                <div class="search-compare-container">
                    <div class="search-bar">
                        <input type="text" id="username" placeholder="Enter GitHub username">
                        <button id="search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="compare-toggle">
                        <button id="compare-mode-btn"><i class="fas fa-code-branch"></i> Compare Profiles</button>
                    </div>
                    <div class="trending-toggle">
                        <button id="trending-btn"><i class="fas fa-fire"></i> Trending</button>
                    </div>
                </div>
                <div id="compare-section" class="compare-section" style="display: none;">
                    <div class="search-bar">
                        <input type="text" id="compare-username" placeholder="Enter second username">
                        <button id="compare-btn"><i class="fas fa-balance-scale"></i> Compare</button>
                    </div>
                </div>
                <div id="trending-section" class="trending-section" style="display: none;">
                    <h3>Trending Developers</h3>
                    <div id="trending-list" class="trending-container"></div>
                </div>
                <div id="search-history" class="search-history"></div>
            </div>

            <div id="loading" class="loading-container">
                <div class="spinner"></div>
                <p>Loading profile data...</p>
            </div>
            
            <div id="error-container" class="error-container card"></div>

            <div id="profile-wrapper" style="display: none;">
                <!-- Profile Header -->
                <div class="profile-header card">
                    <img id="avatar" class="profile-avatar" src="" alt="Avatar">
                    <div class="profile-info">
                        <h1 id="name"></h1>
                        <p id="login"></p>
                        <p id="bio"></p>
                        <div class="profile-meta">
                            <span id="location"><i class="fas fa-map-marker-alt"></i></span>
                            <span id="company"><i class="fas fa-building"></i></span>
                            <span id="blog-link"><i class="fas fa-link"></i></span>
                            <span id="twitter-link"><i class="fab fa-twitter"></i></span>
                        </div>
                        <div class="profile-stats">
                            <div><strong id="followers-count"></strong> followers</div>
                            <div><strong id="following-count"></strong> following</div>
                            <div><strong id="stars-count"></strong> <i class="fas fa-star"></i></div>
                        </div>
                        <div>
                            <a id="profile_link" href="#" target="_blank" class="btn btn-primary"><i class="fab fa-github"></i> View on GitHub</a>
                            <button id="export-pdf-btn" class="btn export-btn"><i class="fas fa-file-pdf"></i> Export PDF</button>
                            <button id="export-json-btn" class="btn export-btn"><i class="fas fa-file-code"></i> Export JSON</button>
                            <button id="export-csv-btn" class="btn export-btn"><i class="fas fa-file-csv"></i> Export CSV</button>
                            <button id="export-image-btn" class="btn export-btn"><i class="fas fa-image"></i> Export Image</button>
                            <button id="share-btn" class="btn export-btn"><i class="fas fa-share-alt"></i> Share</button>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <nav class="tab-nav">
                    <a href="#" class="tab-item active" data-tab="overview"><i class="fas fa-chart-line"></i> Overview</a>
                    <a href="#" class="tab-item" data-tab="repositories"><i class="fas fa-code-branch"></i> Repositories <span id="repo-count" class="Counter"></span></a>
                    <a href="#" class="tab-item" data-tab="starred"><i class="fas fa-star"></i> Starred <span id="starred-count" class="Counter"></span></a>
                    <a href="#" class="tab-item" data-tab="activity"><i class="fas fa-history"></i> Activity</a>
                    <a href="#" class="tab-item" data-tab="ai-insights"><i class="fas fa-brain"></i> AI Insights</a>
                    <a href="#" class="tab-item" data-tab="repo-health"><i class="fas fa-heartbeat"></i> Repository Health</a>
                    <a href="#" class="tab-item" data-tab="contribution-streak"><i class="fas fa-fire"></i> Contribution Streak</a>
                    <a href="#" class="tab-item" data-tab="activity-heatmap"><i class="fas fa-calendar-alt"></i> Activity Heatmap</a>
                    <a href="#" class="tab-item" data-tab="follower-growth"><i class="fas fa-chart-area"></i> Follower Growth</a>
                    <a href="#" class="tab-item" data-tab="skills-radar"><i class="fas fa-spider"></i> Skills Radar</a>
                    <a href="#" class="tab-item" data-tab="project-timeline"><i class="fas fa-stream"></i> Project Timeline</a>
                    <a href="#" class="tab-item" data-tab="collaboration-network"><i class="fas fa-project-diagram"></i> Collaboration Network</a>
                    <a href="#" class="tab-item" data-tab="achievements"><i class="fas fa-trophy"></i> Achievements</a>
                    <a href="#" class="tab-item" data-tab="productivity-score"><i class="fas fa-tachometer-alt"></i> Productivity Score</a>
                    <a href="#" class="tab-item" data-tab="code-quality"><i class="fas fa-code"></i> Code Quality</a>
                    <a href="#" class="tab-item" data-tab="social-influence"><i class="fas fa-users"></i> Social Influence</a>
                    <a href="#" class="tab-item" data-tab="activity-patterns"><i class="fas fa-clock"></i> Activity Patterns</a>
                    <a href="#" class="tab-item" data-tab="project-diversity"><i class="fas fa-sitemap"></i> Project Diversity</a>
                    <a href="#" class="tab-item" data-tab="timezone-analysis"><i class="fas fa-globe"></i> Timezone Analysis</a>
                </nav>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Overview Tab -->
                    <div id="overview" class="tab-pane active">
                        <div class="content-grid">
                            <div class="pinned-repos-section card">
                                <h2>Pinned</h2>
                                <div id="pinned-repos-list" class="pinned-grid"></div>
                            </div>
                            <div class="activity-section card">
                                <h2>Contribution activity</h2>
                                <div id="contribution-graph" class="contribution-graph"></div>
                                <p id="contrib-count"> contributions in the last year</p>
                            </div>
                        </div>
                        <div class="languages-section card">
                            <h2>Languages</h2>
                            <div id="language-breakdown" class="language-chart"></div>
                        </div>
                    </div>

                    <!-- Repositories Tab -->
                    <div id="repositories" class="tab-pane">
                        <div class="repo-controls card">
                            <div class="control-group">
                                <input type="search" id="repo-search" placeholder="Find a repository...">
                                <select id="repo-language-filter">
                                    <option value="">Language: All</option>
                                </select>
                                <select id="repo-sort">
                                    <option value="updated">Last updated</option>
                                    <option value="name">Name</option>
                                    <option value="stars">Stars</option>
                                </select>
                            </div>
                            <div class="view-toggle">
                                <button id="list-view-btn" class="view-btn active" title="List view"><i class="fas fa-list"></i></button>
                                <button id="grid-view-btn" class="view-btn" title="Grid view"><i class="fas fa-th"></i></button>
                            </div>
                        </div>
                        <div id="repo-list" class="repo-list-container list-view"></div>
                        <div id="repo-pagination" class="pagination-container"></div>
                    </div>

                    <!-- Starred Tab -->
                    <div id="starred" class="tab-pane">
                        <div class="starred-controls card">
                            <div class="control-group">
                                <input type="search" id="starred-search" placeholder="Find a starred repository...">
                                <select id="starred-language-filter">
                                    <option value="">Language: All</option>
                                </select>
                                <select id="starred-sort">
                                    <option value="starred_at">Starred on</option>
                                    <option value="name">Name</option>
                                    <option value="stars">Stars</option>
                                </select>
                            </div>
                        </div>
                        <div id="starred-list" class="starred-list-container list-view"></div>
                        <div id="starred-pagination" class="pagination-container"></div>
                    </div>

                    <!-- Activity Tab -->
                    <div id="activity" class="tab-pane">
                        <div id="activity-feed" class="activity-feed"></div>
                    </div>

                    <!-- AI Insights Tab -->
                    <div id="ai-insights" class="tab-pane">
                        <div class="ai-controls card">
                            <h2>AI-Powered Analysis</h2>
                            <div class="ai-suggestions">
                                <button class="suggestion-btn" data-query="Provide a detailed summary of this developer's key skills and primary programming languages based on their repositories.">Summarize Skills</button>
                                <button class="suggestion-btn" data-query="Identify and describe the top 3 most interesting or impactful projects in their portfolio.">Top 3 Projects</button>
                                <button class="suggestion-btn" data-query="Analyze their contribution pattern. Are they a consistent committer? What is their typical activity like?">Analyze Activity</button>
                                <button class="suggestion-btn" data-query="Provide insights about this developer's collaboration patterns and community involvement.">Collaboration Insights</button>
                                <button class="suggestion-btn" data-query="Suggest potential career opportunities or open-source projects that align with this developer's skills and interests.">Career Opportunities</button>
                            </div>
                        </div>
                        <div class="ai-input-container card">
                            <input type="text" id="ai-query" placeholder="Ask anything about this profile...">
                            <button id="ask-ai-btn"><i class="fas fa-paper-plane"></i> Ask AI</button>
                        </div>
                        <div id="ai-response" class="ai-response card"></div>
                    </div>

                    <!-- Repository Health Tab -->
                    <div id="repo-health" class="tab-pane">
                        <div class="card">
                            <h2>Repository Health Analysis</h2>
                            <div id="health-metrics" class="health-metrics"></div>
                            <div id="health-recommendations" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <!-- Contribution Streak Tab -->
                    <div id="contribution-streak" class="tab-pane">
                        <div class="card">
                            <h2>Contribution Streak</h2>
                            <div class="streak-container">
                                <div class="streak-header">
                                    <div>
                                        <div class="streak-value" id="current-streak">0</div>
                                        <div>Current Streak</div>
                                    </div>
                                    <div>
                                        <div class="streak-value" id="longest-streak">0</div>
                                        <div>Longest Streak</div>
                                    </div>
                                </div>
                                <div class="streak-calendar" id="streak-calendar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Heatmap Tab -->
                    <div id="activity-heatmap" class="tab-pane">
                        <div class="card">
                            <h2>Activity Heatmap</h2>
                            <div class="activity-heatmap">
                                <div class="heatmap-container" id="heatmap-container"></div>
                                <div class="heatmap-legend">
                                    <span>12 AM</span>
                                    <span>6 AM</span>
                                    <span>12 PM</span>
                                    <span>6 PM</span>
                                    <span>11 PM</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Follower Growth Tab -->
                    <div id="follower-growth" class="tab-pane">
                        <div class="card">
                            <h2>Follower Growth</h2>
                            <div class="growth-chart">
                                <canvas id="growth-canvas" class="growth-canvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Skills Radar Tab -->
                    <div id="skills-radar" class="tab-pane">
                        <div class="card">
                            <h2>Skills Radar</h2>
                            <div class="skills-radar">
                                <canvas id="skills-radar-canvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Project Timeline Tab -->
                    <div id="project-timeline" class="tab-pane">
                        <div class="card">
                            <h2>Project Timeline</h2>
                            <div id="timeline-container" class="timeline-container"></div>
                        </div>
                    </div>

                    <!-- Collaboration Network Tab -->
                    <div id="collaboration-network" class="tab-pane">
                        <div class="card">
                            <h2>Collaboration Network</h2>
                            <div id="network-container" class="network-container">
                                <canvas id="network-canvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Achievements Tab -->
                    <div id="achievements" class="tab-pane">
                        <div class="card">
                            <h2>Achievements</h2>
                            <div id="achievements-container" class="achievements-container"></div>
                        </div>
                    </div>

                    <!-- Productivity Score Tab -->
                    <div id="productivity-score" class="tab-pane">
                        <div class="card">
                            <h2>Productivity Score</h2>
                            <div class="productivity-score">
                                <div class="score-circle">
                                    <svg width="150" height="150">
                                        <circle class="score-circle-bg" cx="75" cy="75" r="70"></circle>
                                        <circle class="score-circle-progress" id="score-progress" cx="75" cy="75" r="70"></circle>
                                    </svg>
                                    <div class="score-value" id="score-value">0</div>
                                </div>
                                <div class="score-label">Overall Productivity Score</div>
                                <div class="score-factors">
                                    <div class="score-factor">
                                        <div class="factor-value" id="commits-factor">0</div>
                                        <div class="factor-label">Commits</div>
                                    </div>
                                    <div class="score-factor">
                                        <div class="factor-value" id="repos-factor">0</div>
                                        <div class="factor-label">Repositories</div>
                                    </div>
                                    <div class="score-factor">
                                        <div class="factor-value" id="issues-factor">0</div>
                                        <div class="factor-label">Issues</div>
                                    </div>
                                    <div class="score-factor">
                                        <div class="factor-value" id="pr-factor">0</div>
                                        <div class="factor-label">Pull Requests</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Code Quality Tab -->
                    <div id="code-quality" class="tab-pane">
                        <div class="card">
                            <h2>Code Quality Analysis</h2>
                            <div id="code-quality-metrics" class="health-metrics"></div>
                            <div id="code-quality-recommendations" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <!-- Social Influence Tab -->
                    <div id="social-influence" class="tab-pane">
                        <div class="card">
                            <h2>Social Influence Analysis</h2>
                            <div id="social-influence-metrics" class="health-metrics"></div>
                            <div id="social-influence-recommendations" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <!-- Activity Patterns Tab -->
                    <div id="activity-patterns" class="tab-pane">
                        <div class="card">
                            <h2>Activity Patterns Analysis</h2>
                            <div id="activity-patterns-chart" style="height: 300px; position: relative;">
                                <canvas id="activity-patterns-canvas"></canvas>
                            </div>
                            <div id="activity-patterns-insights" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <!-- Project Diversity Tab -->
                    <div id="project-diversity" class="tab-pane">
                        <div class="card">
                            <h2>Project Diversity Analysis</h2>
                            <div id="project-diversity-chart" style="height: 300px; position: relative;">
                                <canvas id="project-diversity-canvas"></canvas>
                            </div>
                            <div id="project-diversity-insights" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <!-- Timezone Analysis Tab -->
                    <div id="timezone-analysis" class="tab-pane">
                        <div class="card">
                            <h2>Timezone Activity Analysis</h2>
                            <div id="timezone-chart" style="height: 300px; position: relative;">
                                <canvas id="timezone-canvas"></canvas>
                            </div>
                            <div id="timezone-insights" style="margin-top: 16px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Results -->
            <div id="comparison-results" class="comparison-results card" style="display: none;">
                <h2>Profile Comparison</h2>
                <div id="comparison-table"></div>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- README Modal -->
    <div id="readme-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="readme-title"></h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div id="readme-body" class="markdown-body"></div>
        </div>
    </div>

    <!-- Commit History Modal -->
    <div id="commit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="commit-title"></h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div id="commit-list" class="commit-list"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const App = {
                // --- State ---
                state: {
                    profileData: null,
                    repositories: [],
                    starredRepos: [],
                    activityData: [],
                    searchHistory: JSON.parse(localStorage.getItem('searchHistory')) || [],
                    currentTab: 'overview',
                    repoView: 'list',
                    starredView: 'list',
                    currentPage: { repos: 1, starred: 1 },
                    reposPerPage: 10,
                    contributionData: [],
                    streakData: { current: 0, longest: 0, contributions: [] },
                    heatmapData: [],
                    followerGrowthData: { months: [], followers: [] },
                    skillsData: [],
                    timelineData: [],
                    collaborationData: { nodes: [], links: [] },
                    achievements: [],
                    productivityScore: 0,
                    trendingDevelopers: [],
                    notifications: [],
                    codeQualityMetrics: {},
                    socialInfluenceMetrics: {},
                    activityPatternsData: {},
                    projectDiversityData: {},
                    timezoneData: {}
                },

                // --- DOM Elements ---
                elements: {
                    usernameInput: document.getElementById('username'),
                    compareUsernameInput: document.getElementById('compare-username'),
                    searchBtn: document.getElementById('search-btn'),
                    compareBtn: document.getElementById('compare-btn'),
                    compareModeBtn: document.getElementById('compare-mode-btn'),
                    compareSection: document.getElementById('compare-section'),
                    trendingBtn: document.getElementById('trending-btn'),
                    trendingSection: document.getElementById('trending-section'),
                    trendingList: document.getElementById('trending-list'),
                    profileWrapper: document.getElementById('profile-wrapper'),
                    loadingContainer: document.getElementById('loading'),
                    errorContainer: document.getElementById('error-container'),
                    comparisonResults: document.getElementById('comparison-results'),
                    themeToggle: document.getElementById('theme-toggle'),
                    notificationBtn: document.getElementById('notification-btn'),
                    notificationContainer: document.getElementById('notification-container'),
                    shareBtn: document.getElementById('share-btn'),
                    tabNav: document.querySelectorAll('.tab-item'),
                    tabPanes: document.querySelectorAll('.tab-pane'),
                    repoSearch: document.getElementById('repo-search'),
                    repoLanguageFilter: document.getElementById('repo-language-filter'),
                    repoSort: document.getElementById('repo-sort'),
                    repoList: document.getElementById('repo-list'),
                    repoPagination: document.getElementById('repo-pagination'),
                    listViewBtn: document.getElementById('list-view-btn'),
                    gridViewBtn: document.getElementById('grid-view-btn'),
                    starredSearch: document.getElementById('starred-search'),
                    starredLanguageFilter: document.getElementById('starred-language-filter'),
                    starredSort: document.getElementById('starred-sort'),
                    starredList: document.getElementById('starred-list'),
                    starredPagination: document.getElementById('starred-pagination'),
                    aiQueryInput: document.getElementById('ai-query'),
                    askAiBtn: document.getElementById('ask-ai-btn'),
                    aiResponse: document.getElementById('ai-response'),
                    aiSuggestions: document.querySelectorAll('.suggestion-btn'),
                    readmeModal: document.getElementById('readme-modal'),
                    readmeTitle: document.getElementById('readme-title'),
                    readmeBody: document.getElementById('readme-body'),
                    modalCloseBtn: document.querySelector('.modal-close-btn'),
                    commitModal: document.getElementById('commit-modal'),
                    commitTitle: document.getElementById('commit-title'),
                    commitList: document.getElementById('commit-list'),
                    exportPdfBtn: document.getElementById('export-pdf-btn'),
                    exportJsonBtn: document.getElementById('export-json-btn'),
                    exportCsvBtn: document.getElementById('export-csv-btn'),
                    exportImageBtn: document.getElementById('export-image-btn'),
                    healthMetrics: document.getElementById('health-metrics'),
                    healthRecommendations: document.getElementById('health-recommendations'),
                    currentStreak: document.getElementById('current-streak'),
                    longestStreak: document.getElementById('longest-streak'),
                    streakCalendar: document.getElementById('streak-calendar'),
                    heatmapContainer: document.getElementById('heatmap-container'),
                    growthCanvas: document.getElementById('growth-canvas'),
                    skillsRadarCanvas: document.getElementById('skills-radar-canvas'),
                    timelineContainer: document.getElementById('timeline-container'),
                    networkCanvas: document.getElementById('network-canvas'),
                    achievementsContainer: document.getElementById('achievements-container'),
                    scoreProgress: document.getElementById('score-progress'),
                    scoreValue: document.getElementById('score-value'),
                    commitsFactor: document.getElementById('commits-factor'),
                    reposFactor: document.getElementById('repos-factor'),
                    issuesFactor: document.getElementById('issues-factor'),
                    prFactor: document.getElementById('pr-factor'),
                    codeQualityMetrics: document.getElementById('code-quality-metrics'),
                    codeQualityRecommendations: document.getElementById('code-quality-recommendations'),
                    socialInfluenceMetrics: document.getElementById('social-influence-metrics'),
                    socialInfluenceRecommendations: document.getElementById('social-influence-recommendations'),
                    activityPatternsCanvas: document.getElementById('activity-patterns-canvas'),
                    activityPatternsInsights: document.getElementById('activity-patterns-insights'),
                    projectDiversityCanvas: document.getElementById('project-diversity-canvas'),
                    projectDiversityInsights: document.getElementById('project-diversity-insights'),
                    timezoneCanvas: document.getElementById('timezone-canvas'),
                    timezoneInsights: document.getElementById('timezone-insights')
                },
                
                // --- Initialization ---
                init() {
                    this.setupEventListeners();
                    this.loadTheme();
                    this.renderSearchHistory();
                    this.loadTrendingDevelopers();
                    this.initializeNotifications();
                },

                setupEventListeners() {
                    // Search functionality
                    this.elements.searchBtn.addEventListener('click', () => this.handleSearch());
                    this.elements.compareBtn.addEventListener('click', () => this.handleCompare());
                    this.elements.compareModeBtn.addEventListener('click', () => this.toggleCompareMode());
                    this.elements.trendingBtn.addEventListener('click', () => this.toggleTrending());
                    this.elements.usernameInput.addEventListener('keypress', (e) => e.key === 'Enter' && this.handleSearch());
                    this.elements.compareUsernameInput.addEventListener('keypress', (e) => e.key === 'Enter' && this.handleCompare());
                    
                    // Theme toggle
                    this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());

                    // Notification toggle
                    this.elements.notificationBtn.addEventListener('click', () => this.toggleNotifications());
                    
                    // Share functionality
                    this.elements.shareBtn.addEventListener('click', () => this.shareProfile());

                    // Tab navigation
                    this.elements.tabNav.forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.switchTab(tab.dataset.tab);
                        });
                    });

                    // Repository controls
                    this.elements.repoSearch.addEventListener('input', () => this.filterAndRenderRepos());
                    this.elements.repoLanguageFilter.addEventListener('change', () => this.filterAndRenderRepos());
                    this.elements.repoSort.addEventListener('change', () => {
                        this.sortRepositories();
                        this.renderRepositories();
                    });
                    this.elements.listViewBtn.addEventListener('click', () => this.setRepoView('list'));
                    this.elements.gridViewBtn.addEventListener('click', () => this.setRepoView('grid'));
                    
                    // Starred controls
                    this.elements.starredSearch.addEventListener('input', () => this.filterAndRenderStarred());
                    this.elements.starredLanguageFilter.addEventListener('change', () => this.filterAndRenderStarred());
                    this.elements.starredSort.addEventListener('change', () => {
                        this.sortStarred();
                        this.renderStarred();
                    });

                    // AI functionality
                    this.elements.askAiBtn.addEventListener('click', () => this.askAI());
                    this.elements.aiQueryInput.addEventListener('keypress', (e) => e.key === 'Enter' && this.askAI());

                    this.elements.aiSuggestions.forEach(btn => {
                        btn.addEventListener('click', () => {
                            this.elements.aiQueryInput.value = btn.dataset.query;
                            this.askAI();
                        });
                    });

                    // Modal functionality
                    this.elements.modalCloseBtn.addEventListener('click', () => {
                        this.elements.readmeModal.style.display = 'none';
                        this.elements.commitModal.style.display = 'none';
                    });
                    
                    window.addEventListener('click', (e) => {
                        if (e.target === this.elements.readmeModal) {
                            this.elements.readmeModal.style.display = 'none';
                        }
                        if (e.target === this.elements.commitModal) {
                            this.elements.commitModal.style.display = 'none';
                        }
                    });

                    // Export functionality
                    this.elements.exportPdfBtn.addEventListener('click', () => this.exportToPDF());
                    this.elements.exportJsonBtn.addEventListener('click', () => this.exportToJSON());
                    this.elements.exportCsvBtn.addEventListener('click', () => this.exportToCSV());
                    this.elements.exportImageBtn.addEventListener('click', () => this.exportToImage());
                },
                
                // --- Core Functions ---
                async handleSearch() {
                    const username = this.elements.usernameInput.value.trim();
                    if (!username) return this.showError("Please enter a username.");

                    this.showLoading();
                    this.clearErrors();
                    this.hideResults();

                    try {
                        this.state.profileData = await this.fetchJSON(`https://api.github.com/users/${username}`);
                        if (!this.state.profileData) throw new Error("User not found.");

                        this.addToSearchHistory(username);
                        await this.fetchAllProfileData(username);
                        this.renderProfile();
                        this.switchTab('overview');
                        this.showResults();
                        this.addNotification('success', 'Profile Loaded', `Successfully loaded profile for ${username}`);
                    } catch (error) {
                        this.showError(error.message);
                        this.addNotification('error', 'Error', error.message);
                    } finally {
                        this.hideLoading();
                    }
                },

                async fetchAllProfileData(username) {
                    try {
                        const [repos, starred, activity] = await Promise.all([
                            this.fetchJSON(`https://api.github.com/users/${username}/repos?per_page=100`),
                            this.fetchJSON(`https://api.github.com/users/${username}/starred?per_page=100`),
                            this.fetchJSON(`https://api.github.com/users/${username}/events/public?per_page=30`)
                        ]);
                        
                        // Ensure all arrays are properly initialized
                        this.state.repositories = Array.isArray(repos) ? repos : [];
                        this.state.starredRepos = Array.isArray(starred) ? starred : [];
                        this.state.activityData = Array.isArray(activity) ? activity : [];
                        
                        // Calculate stars count safely
                        this.state.profileData.total_stars = this.state.repositories.reduce((total, repo) => {
                            return total + (repo && repo.stargazers_count ? repo.stargazers_count : 0);
                        }, 0);
                        
                        // Fetch and process contribution data
                        const contributions = await this.fetchContributionData(username);
                        this.state.contributionData = Array.isArray(contributions) ? contributions : [];
                        
                        // Process contribution data for streaks and heatmap
                        this.processContributionData();
                        
                        // Generate mock follower growth data
                        this.generateFollowerGrowthData();
                        
                        // Generate skills data
                        this.generateSkillsData();
                        
                        // Generate timeline data
                        this.generateTimelineData();
                        
                        // Generate collaboration network data
                        this.generateCollaborationData();
                        
                        // Generate achievements
                        this.generateAchievements();
                        
                        // Calculate productivity score
                        this.calculateProductivityScore();
                        
                        // Generate code quality metrics
                        this.generateCodeQualityMetrics();
                        
                        // Generate social influence metrics
                        this.generateSocialInfluenceMetrics();
                        
                        // Generate activity patterns data
                        this.generateActivityPatternsData();
                        
                        // Generate project diversity data
                        this.generateProjectDiversityData();
                        
                        // Generate timezone data
                        this.generateTimezoneData();
                    } catch (error) {
                        console.error("Error fetching profile data:", error);
                        // Ensure arrays are initialized even on error
                        this.state.repositories = [];
                        this.state.starredRepos = [];
                        this.state.activityData = [];
                        this.state.contributionData = [];
                    }
                },

                async fetchContributionData(username) {
                    try {
                        // Generate mock contribution data based on activity
                        const data = this.state.activityData;
                        const contributions = [];
                        const today = new Date();
                        
                        // Generate data for the last year
                        for (let i = 0; i < 365; i++) {
                            const date = new Date(today);
                            date.setDate(date.getDate() - i);
                            
                            // Count events on this day
                            const dayEvents = data.filter(event => {
                                if (!event || !event.created_at) return false;
                                const eventDate = new Date(event.created_at);
                                return eventDate.toDateString() === date.toDateString();
                            });
                            
                            contributions.push({
                                date: date.toISOString().split('T')[0],
                                count: dayEvents.length,
                                level: dayEvents.length === 0 ? 0 : 
                                       dayEvents.length < 3 ? 1 : 
                                       dayEvents.length < 6 ? 2 : 
                                       dayEvents.length < 10 ? 3 : 4
                            });
                        }
                        
                        return contributions.reverse();
                    } catch (error) {
                        console.error("Error fetching contribution data:", error);
                        return [];
                    }
                },

                processContributionData() {
                    try {
                        const contributions = Array.isArray(this.state.contributionData) ? this.state.contributionData : [];
                        let currentStreak = 0;
                        let longestStreak = 0;
                        let tempStreak = 0;
                        
                        // Calculate streaks
                        for (let i = contributions.length - 1; i >= 0; i--) {
                            if (contributions[i] && contributions[i].count > 0) {
                                if (i === contributions.length - 1 || (contributions[i + 1] && contributions[i + 1].count > 0)) {
                                    currentStreak++;
                                } else {
                                    currentStreak = 1;
                                }
                                tempStreak++;
                                longestStreak = Math.max(longestStreak, tempStreak);
                            } else {
                                tempStreak = 0;
                                if (i < contributions.length - 1) break;
                            }
                        }
                        
                        this.state.streakData = {
                            current: currentStreak,
                            longest: longestStreak,
                            contributions: contributions
                        };
                        
                        // Process heatmap data
                        const heatmapData = Array(7).fill().map(() => Array(24).fill(0));
                        
                        this.state.activityData.forEach(event => {
                            if (!event || !event.created_at) return;
                            const date = new Date(event.created_at);
                            const day = date.getDay();
                            const hour = date.getHours();
                            if (day >= 0 && day < 7 && hour >= 0 && hour < 24) {
                                heatmapData[day][hour]++;
                            }
                        });
                        
                        // Normalize data for visualization
                        const maxActivity = Math.max(...heatmapData.flat());
                        this.state.heatmapData = heatmapData.map(day => 
                            day.map(hour => maxActivity > 0 ? hour / maxActivity : 0)
                        );
                    } catch (error) {
                        console.error("Error processing contribution data:", error);
                        this.state.streakData = { current: 0, longest: 0, contributions: [] };
                        this.state.heatmapData = Array(7).fill().map(() => Array(24).fill(0));
                    }
                },

                generateFollowerGrowthData() {
                    try {
                        const months = [];
                        const followers = [];
                        const today = new Date();
                        const currentFollowers = this.state.profileData && this.state.profileData.followers ? this.state.profileData.followers : 0;
                        
                        for (let i = 11; i >= 0; i--) {
                            const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                            months.push(date.toLocaleDateString('en', { month: 'short', year: 'numeric' }));
                            
                            const growthFactor = 1 - (i * 0.08);
                            const randomVariation = 0.9 + Math.random() * 0.2;
                            followers.push(Math.floor(currentFollowers * growthFactor * randomVariation));
                        }
                        
                        this.state.followerGrowthData = { months, followers };
                    } catch (error) {
                        console.error("Error generating follower growth data:", error);
                        this.state.followerGrowthData = { months: [], followers: [] };
                    }
                },

                generateSkillsData() {
                    try {
                        const languages = {};
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        
                        repos.forEach(repo => {
                            if (repo && repo.language) {
                                languages[repo.language] = (languages[repo.language] || 0) + 1;
                            }
                        });
                        
                        // Convert to radar chart format
                        this.state.skillsData = Object.entries(languages).map(([language, count]) => ({
                            skill: language,
                            value: Math.min(count * 10, 100), // Cap at 100
                            fullMark: 100
                        }));
                    } catch (error) {
                        console.error("Error generating skills data:", error);
                        this.state.skillsData = [];
                    }
                },

                generateTimelineData() {
                    try {
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        
                        // Sort repositories by creation date
                        const sortedRepos = repos.filter(repo => repo && repo.created_at)
                            .sort((a, b) => new Date(a.created_at) - new Date(b.created_at))
                            .slice(-10); // Get the 10 most recent
                        
                        this.state.timelineData = sortedRepos.map(repo => ({
                            date: new Date(repo.created_at).toLocaleDateString(),
                            title: repo.name,
                            description: repo.description || 'No description available',
                            language: repo.language || 'Unknown'
                        }));
                    } catch (error) {
                        console.error("Error generating timeline data:", error);
                        this.state.timelineData = [];
                    }
                },

                generateCollaborationData() {
                    try {
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        const collaborators = new Set();
                        const links = [];
                        
                        // Add the user as the central node
                        const nodes = [{
                            id: this.state.profileData.login,
                            name: this.state.profileData.name || this.state.profileData.login,
                            group: 1,
                            size: 20
                        }];
                        
                        // Process repositories to find collaborators
                        repos.forEach(repo => {
                            if (!repo || !repo.contributors_url) return;
                            
                            // Add repository as a node
                            nodes.push({
                                id: repo.name,
                                name: repo.name,
                                group: 2,
                                size: 10 + (repo.stargazers_count || 0) / 10
                            });
                            
                            // Link user to repository
                            links.push({
                                source: this.state.profileData.login,
                                target: repo.name,
                                value: 5
                            });
                        });
                        
                        // Add some mock collaborators for visualization
                        const mockCollaborators = ['alice', 'bob', 'charlie', 'diana', 'eve'];
                        mockCollaborators.forEach((name, index) => {
                            if (Math.random() > 0.5) { // Randomly include some collaborators
                                nodes.push({
                                    id: name,
                                    name: name,
                                    group: 3,
                                    size: 5 + Math.random() * 10
                                });
                                
                                // Link to random repositories
                                const repoCount = Math.floor(Math.random() * 3) + 1;
                                for (let i = 0; i < repoCount; i++) {
                                    const randomRepoIndex = Math.floor(Math.random() * (repos.length - 1)) + 1;
                                    if (nodes[randomRepoIndex]) {
                                        links.push({
                                            source: name,
                                            target: nodes[randomRepoIndex].id,
                                            value: Math.random() * 5
                                        });
                                    }
                                }
                            }
                        });
                        
                        this.state.collaborationData = { nodes, links };
                    } catch (error) {
                        console.error("Error generating collaboration data:", error);
                        this.state.collaborationData = { nodes: [], links: [] };
                    }
                },

                generateAchievements() {
                    try {
                        const achievements = [];
                        const profile = this.state.profileData;
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        const streak = this.state.streakData;
                        
                        // Repository count achievements
                        if (repos.length >= 1) {
                            achievements.push({
                                id: 'first-repo',
                                name: 'First Repository',
                                description: 'Created your first repository',
                                icon: 'fa-folder-open',
                                unlocked: true
                            });
                        }
                        
                        if (repos.length >= 10) {
                            achievements.push({
                                id: 'ten-repos',
                                name: 'Prolific Developer',
                                description: 'Created 10 or more repositories',
                                icon: 'fa-code-branch',
                                unlocked: true
                            });
                        }
                        
                        if (repos.length >= 50) {
                            achievements.push({
                                id: 'fifty-repos',
                                name: 'Repository Master',
                                description: 'Created 50 or more repositories',
                                icon: 'fa-code',
                                unlocked: true
                            });
                        }
                        
                        // Follower achievements
                        if (profile && profile.followers >= 10) {
                            achievements.push({
                                id: 'ten-followers',
                                name: 'Rising Star',
                                description: 'Gained 10 or more followers',
                                icon: 'fa-star',
                                unlocked: true
                            });
                        }
                        
                        if (profile && profile.followers >= 100) {
                            achievements.push({
                                id: 'hundred-followers',
                                name: 'GitHub Celebrity',
                                description: 'Gained 100 or more followers',
                                icon: 'fa-crown',
                                unlocked: true
                            });
                        }
                        
                        // Streak achievements
                        if (streak.current >= 7) {
                            achievements.push({
                                id: 'week-streak',
                                name: 'Weekly Warrior',
                                description: 'Maintained a 7-day contribution streak',
                                icon: 'fa-fire',
                                unlocked: true
                            });
                        }
                        
                        if (streak.longest >= 30) {
                            achievements.push({
                                id: 'month-streak',
                                name: 'Monthly Master',
                                description: 'Maintained a 30-day contribution streak',
                                icon: 'fa-fire-alt',
                                unlocked: true
                            });
                        }
                        
                        // Stars achievements
                        const totalStars = repos.reduce((total, repo) => total + (repo && repo.stargazers_count ? repo.stargazers_count : 0), 0);
                        if (totalStars >= 10) {
                            achievements.push({
                                id: 'ten-stars',
                                name: 'Star Collector',
                                description: 'Repositories received 10 or more stars',
                                icon: 'fa-star',
                                unlocked: true
                            });
                        }
                        
                        if (totalStars >= 100) {
                            achievements.push({
                                id: 'hundred-stars',
                                name: 'Star Magnet',
                                description: 'Repositories received 100 or more stars',
                                icon: 'fa-star-half-alt',
                                unlocked: true
                            });
                        }
                        
                        // Language diversity achievements
                        const languages = new Set();
                        repos.forEach(repo => {
                            if (repo && repo.language) {
                                languages.add(repo.language);
                            }
                        });
                        
                        if (languages.size >= 3) {
                            achievements.push({
                                id: 'polyglot',
                                name: 'Polyglot Programmer',
                                description: 'Used 3 or more programming languages',
                                icon: 'fa-language',
                                unlocked: true
                            });
                        }
                        
                        if (languages.size >= 5) {
                            achievements.push({
                                id: 'language-master',
                                name: 'Language Master',
                                description: 'Used 5 or more programming languages',
                                icon: 'fa-globe',
                                unlocked: true
                            });
                        }
                        
                        // Add some locked achievements as goals
                        if (repos.length < 100) {
                            achievements.push({
                                id: 'hundred-repos',
                                name: 'Repository Legend',
                                description: 'Create 100 or more repositories',
                                icon: 'fa-trophy',
                                unlocked: false
                            });
                        }
                        
                        if (profile && profile.followers < 1000) {
                            achievements.push({
                                id: 'thousand-followers',
                                name: 'GitHub Icon',
                                description: 'Gain 1000 or more followers',
                                icon: 'fa-award',
                                unlocked: false
                            });
                        }
                        
                        this.state.achievements = achievements;
                    } catch (error) {
                        console.error("Error generating achievements:", error);
                        this.state.achievements = [];
                    }
                },

                calculateProductivityScore() {
                    try {
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        const activity = Array.isArray(this.state.activityData) ? this.state.activityData : [];
                        const streak = this.state.streakData;
                        
                        // Calculate factors
                        const commitsFactor = Math.min(activity.filter(e => e && e.type === 'PushEvent').length * 2, 100);
                        const reposFactor = Math.min(repos.length * 5, 100);
                        const issuesFactor = Math.min(repos.reduce((total, repo) => total + (repo && repo.open_issues_count ? repo.open_issues_count : 0), 0) * 3, 100);
                        const prFactor = Math.min(activity.filter(e => e && e.type === 'PullRequestEvent').length * 5, 100);
                        
                        // Calculate overall score (weighted average)
                        const overallScore = Math.round(
                            commitsFactor * 0.3 + 
                            reposFactor * 0.2 + 
                            issuesFactor * 0.2 + 
                            prFactor * 0.3
                        );
                        
                        this.state.productivityScore = overallScore;
                        
                        // Update UI elements
                        if (this.elements.scoreValue) {
                            this.elements.scoreValue.textContent = overallScore;
                        }
                        if (this.elements.commitsFactor) {
                            this.elements.commitsFactor.textContent = commitsFactor;
                        }
                        if (this.elements.reposFactor) {
                            this.elements.reposFactor.textContent = reposFactor;
                        }
                        if (this.elements.issuesFactor) {
                            this.elements.issuesFactor.textContent = issuesFactor;
                        }
                        if (this.elements.prFactor) {
                            this.elements.prFactor.textContent = prFactor;
                        }
                        
                        // Update progress circle
                        if (this.elements.scoreProgress) {
                            const circumference = 2 * Math.PI * 70;
                            const offset = circumference - (overallScore / 100) * circumference;
                            this.elements.scoreProgress.style.strokeDashoffset = offset;
                        }
                    } catch (error) {
                        console.error("Error calculating productivity score:", error);
                    }
                },

                generateCodeQualityMetrics() {
                    try {
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        const activity = Array.isArray(this.state.activityData) ? this.state.activityData : [];
                        
                        // Calculate code quality metrics
                        const totalCommits = activity.filter(e => e && e.type === 'PushEvent').length;
                        const totalIssues = repos.reduce((total, repo) => total + (repo && repo.open_issues_count ? repo.open_issues_count : 0), 0);
                        const totalPullRequests = activity.filter(e => e && e.type === 'PullRequestEvent').length;
                        const totalReleases = repos.reduce((total, repo) => total + (repo && repo.releases ? repo.releases.length : 0), 0);
                        
                        // Calculate average commit message length (mock data)
                        const avgCommitMessageLength = 25 + Math.random() * 50;
                        
                        // Calculate code coverage (mock data)
                        const avgCodeCoverage = 60 + Math.random() * 30;
                        
                        // Calculate technical debt (mock data)
                        const technicalDebt = Math.floor(Math.random() * 100);
                        
                        // Calculate documentation quality (mock data)
                        const documentationQuality = 60 + Math.random() * 30;
                        
                        this.state.codeQualityMetrics = {
                            totalCommits,
                            totalIssues,
                            totalPullRequests,
                            totalReleases,
                            avgCommitMessageLength: Math.round(avgCommitMessageLength),
                            avgCodeCoverage: Math.round(avgCodeCoverage),
                            technicalDebt,
                            documentationQuality: Math.round(documentationQuality)
                        };
                    } catch (error) {
                        console.error("Error generating code quality metrics:", error);
                        this.state.codeQualityMetrics = {};
                    }
                },

                generateSocialInfluenceMetrics() {
                    try {
                        const profile = this.state.profileData;
                        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
                        
                        // Calculate social influence metrics
                        const followers = profile && profile.followers ? profile.followers : 0;
                        const following = profile && profile.following ? profile.following : 0;
                        const totalStars = repos.reduce((total, repo) => total + (repo && repo.stargazers_count ? repo.stargazers_count : 0), 0);
                        const totalForks = repos.reduce((total, repo) => total + (repo && repo.forks_count ? repo.forks_count : 0), 0);


const totalWatchers = repos.reduce((total, repo) => total + (repo && repo.watchers_count ? repo.watchers_count : 0), 0);
        
        // Calculate engagement metrics
        const followerToFollowingRatio = following > 0 ? (followers / following).toFixed(2) : followers;
        const starToForkRatio = totalForks > 0 ? (totalStars / totalForks).toFixed(2) : totalStars;
        
        // Calculate influence score (mock calculation)
        const influenceScore = Math.round(
            (followers * 0.4) + 
            (totalStars * 0.3) + 
            (totalForks * 0.2) + 
            (totalWatchers * 0.1)
        );
        
        this.state.socialInfluenceMetrics = {
            followers,
            following,
            totalStars,
            totalForks,
            totalWatchers,
            followerToFollowingRatio,
            starToForkRatio,
            influenceScore
        };
    } catch (error) {
        console.error("Error generating social influence metrics:", error);
        this.state.socialInfluenceMetrics = {};
    }
},

generateActivityPatternsData() {
    try {
        const activity = Array.isArray(this.state.activityData) ? this.state.activityData : [];
        const dayOfWeekActivity = Array(7).fill(0);
        const hourOfDayActivity = Array(24).fill(0);
        
        activity.forEach(event => {
            if (!event || !event.created_at) return;
            const date = new Date(event.created_at);
            const day = date.getDay();
            const hour = date.getHours();
            
            if (day >= 0 && day < 7) dayOfWeekActivity[day]++;
            if (hour >= 0 && hour < 24) hourOfDayActivity[hour]++;
        });
        
        const mostActiveDay = this.getDayName(dayOfWeekActivity.indexOf(Math.max(...dayOfWeekActivity)));
        const mostActiveHour = hourOfDayActivity.indexOf(Math.max(...hourOfDayActivity));
        
        this.state.activityPatternsData = {
            dayOfWeekActivity,
            hourOfDayActivity,
            mostActiveDay,
            mostActiveHour
        };
    } catch (error) {
        console.error("Error generating activity patterns data:", error);
        this.state.activityPatternsData = {};
    }
},

generateProjectDiversityData() {
    try {
        const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
        const languages = {};
        const topics = new Set();
        const sizes = [];
        
        repos.forEach(repo => {
            if (!repo) return;
            
            // Collect languages
            if (repo.language) {
                languages[repo.language] = (languages[repo.language] || 0) + 1;
            }
            
            // Collect topics
            if (repo.topics) {
                repo.topics.forEach(topic => topics.add(topic));
            }
            
            // Collect sizes
            if (repo.size) {
                sizes.push(repo.size);
            }
        });
        
        const languageCount = Object.keys(languages).length;
        const topicCount = topics.size;
        const avgRepoSize = sizes.length > 0 ? sizes.reduce((sum, size) => sum + size, 0) / sizes.length : 0;
        
        // Calculate diversity score (mock calculation)
        const diversityScore = Math.round(
            (languageCount * 10) + 
            (topicCount * 5) + 
            (avgRepoSize > 0 ? Math.min(avgRepoSize / 100, 20) : 0)
        );
        
        this.state.projectDiversityData = {
            languageCount,
            topicCount,
            avgRepoSize: Math.round(avgRepoSize),
            diversityScore,
            languageBreakdown: languages
        };
    } catch (error) {
        console.error("Error generating project diversity data:", error);
        this.state.projectDiversityData = {};
    }
},

generateTimezoneData() {
    try {
        const activity = Array.isArray(this.state.activityData) ? this.state.activityData : [];
        const timezoneOffsets = {};
        
        activity.forEach(event => {
            if (!event || !event.created_at) return;
            const date = new Date(event.created_at);
            const offset = date.getTimezoneOffset();
            timezoneOffsets[offset] = (timezoneOffsets[offset] || 0) + 1;
        });
        
        // Find the most likely timezone
        let mostLikelyTimezone = null;
        let maxActivity = 0;
        
        for (const offset in timezoneOffsets) {
            if (timezoneOffsets[offset] > maxActivity) {
                maxActivity = timezoneOffsets[offset];
                mostLikelyTimezone = parseInt(offset);
            }
        }
        
        // Convert offset to timezone name (mock conversion)
        const timezoneName = this.getTimezoneName(mostLikelyTimezone);
        
        this.state.timezoneData = {
            mostLikelyTimezone,
            timezoneName,
            activityByTimezone: timezoneOffsets
        };
    } catch (error) {
        console.error("Error generating timezone data:", error);
        this.state.timezoneData = {};
    }
},

async loadTrendingDevelopers() {
    try {
        // Generate mock trending developers
        const names = ['torvalds', 'gaearon', 'sindresorhus', 'addyosmani', 'mojombo', 'defunkt', 'pjhyett', 'wycats', 'ezmobius', 'ivey'];
        const developers = [];
        
        for (let i = 0; i < 5; i++) {
            const name = names[Math.floor(Math.random() * names.length)];
            const data = await this.fetchJSON(`https://api.github.com/users/${name}`);
            if (data) {
                developers.push({
                    name: data.name || data.login,
                    username: data.login,
                    avatar: data.avatar_url,
                    repos: data.public_repos,
                    followers: data.followers
                });
            }
        }
        
        this.state.trendingDevelopers = developers;
        this.renderTrendingDevelopers();
    } catch (error) {
        console.error("Error loading trending developers:", error);
    }
},

renderTrendingDevelopers() {
    const container = this.elements.trendingList;
    if (!container) return;
    
    container.innerHTML = this.state.trendingDevelopers.map((dev, index) => `
        <div class="trending-item">
            <div class="trending-rank">${index + 1}</div>
            <div class="trending-info">
                <div class="trending-name">${dev.name}</div>
                <div class="trending-stats">
                    <i class="fas fa-code-branch"></i> ${dev.repos} repos
                    <i class="fas fa-users"></i> ${dev.followers} followers
                </div>
            </div>
        </div>
    `).join('');
},

initializeNotifications() {
    // Add a welcome notification
    setTimeout(() => {
        this.addNotification('info', 'Welcome to GitHub Profile Analyzer', 'Search for a GitHub username to get started');
    }, 1000);
},

addNotification(type, title, message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    
    let icon = 'fa-info-circle';
    if (type === 'success') icon = 'fa-check-circle';
    if (type === 'error') icon = 'fa-exclamation-circle';
    if (type === 'warning') icon = 'fa-exclamation-triangle';
    
    notification.innerHTML = `
        <div class="notification-icon"><i class="fas ${icon}"></i></div>
        <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        </div>
        <div class="notification-close"><i class="fas fa-times"></i></div>
    `;
    
    this.elements.notificationContainer.appendChild(notification);
    
    // Add close functionality
    notification.querySelector('.notification-close').addEventListener('click', () => {
        notification.remove();
    });
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
},

toggleNotifications() {
    // This would typically show a dropdown with recent notifications
    this.addNotification('info', 'Notifications', 'You have no new notifications');
},

shareProfile() {
    if (!this.state.profileData || !this.state.profileData.login) return;
    
    const shareUrl = `${window.location.origin}?user=${this.state.profileData.login}`;
    
    if (navigator.share) {
        navigator.share({
            title: `${this.state.profileData.login}'s GitHub Profile`,
            text: `Check out ${this.state.profileData.login}'s GitHub profile analysis`,
            url: shareUrl
        }).catch(err => console.error('Error sharing:', err));
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(shareUrl)
            .then(() => this.addNotification('success', 'Link Copied', 'Profile link copied to clipboard'))
            .catch(err => console.error('Error copying link:', err));
    }
},

toggleTrending() {
    if (!this.elements.trendingSection) return;
    
    const isVisible = this.elements.trendingSection.style.display !== 'none';
    this.elements.trendingSection.style.display = isVisible ? 'none' : 'block';
},

renderProfile() {
    try {
        // Header
        const avatar = document.getElementById('avatar');
        const name = document.getElementById('name');
        const login = document.getElementById('login');
        const bio = document.getElementById('bio');
        
        if (avatar && this.state.profileData && this.state.profileData.avatar_url) {
            avatar.src = this.state.profileData.avatar_url;
        }
        if (name) name.textContent = (this.state.profileData && this.state.profileData.name) || (this.state.profileData && this.state.profileData.login) || '';
        if (login) login.textContent = this.state.profileData ? `@${this.state.profileData.login}` : '';
        if (bio) bio.textContent = (this.state.profileData && this.state.profileData.bio) || '';
        
        // Meta information
        const location = document.getElementById('location');
        const company = document.getElementById('company');
        const blogLink = document.getElementById('blog-link');
        const twitterLink = document.getElementById('twitter-link');
        
        if (location) location.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${(this.state.profileData && this.state.profileData.location) || 'Not Specified'}`;
        if (company) company.innerHTML = `<i class="fas fa-building"></i> ${(this.state.profileData && this.state.profileData.company) || 'Not Specified'}`;
        if (blogLink && this.state.profileData && this.state.profileData.blog) {
            blogLink.innerHTML = `<i class="fas fa-link"></i> <a href="${this.state.profileData.blog}" target="_blank">${this.state.profileData.blog}</a>`;
        }
        if (twitterLink && this.state.profileData && this.state.profileData.twitter_username) {
            twitterLink.innerHTML = `<i class="fab fa-twitter"></i> <a href="https://twitter.com/${this.state.profileData.twitter_username}" target="_blank">${this.state.profileData.twitter_username}</a>`;
        }
        
        // Stats
        const followersCount = document.getElementById('followers-count');
        const followingCount = document.getElementById('following-count');
        const starsCount = document.getElementById('stars-count');
        const repoCount = document.getElementById('repo-count');
        const starredCount = document.getElementById('starred-count');
        const profileLink = document.getElementById('profile_link');
        
        if (followersCount) followersCount.textContent = (this.state.profileData && this.state.profileData.followers) || 0;
        if (followingCount) followingCount.textContent = (this.state.profileData && this.state.profileData.following) || 0;
        if (starsCount) starsCount.textContent = (this.state.profileData && this.state.profileData.total_stars) || 0;
        if (repoCount) repoCount.textContent = (this.state.profileData && this.state.profileData.public_repos) || 0;
        if (starredCount) starredCount.textContent = (this.state.starredRepos && this.state.starredRepos.length) || 0;
        if (profileLink && this.state.profileData && this.state.profileData.html_url) {
            profileLink.href = this.state.profileData.html_url;
        }

        // Tab-specific renders
        this.renderOverviewTab();
        this.renderRepositoriesTab();
        this.renderStarredTab();
        this.renderActivityTab();
        this.renderRepoHealthTab();
        this.renderContributionStreakTab();
        this.renderActivityHeatmapTab();
        this.renderFollowerGrowthTab();
        this.renderSkillsRadarTab();
        this.renderProjectTimelineTab();
        this.renderCollaborationNetworkTab();
        this.renderAchievementsTab();
        this.renderProductivityScoreTab();
        this.renderCodeQualityTab();
        this.renderSocialInfluenceTab();
        this.renderActivityPatternsTab();
        this.renderProjectDiversityTab();
        this.renderTimezoneAnalysisTab();
        this.populateLanguageFilter();
        this.populateStarredLanguageFilter();
    } catch (error) {
        console.error("Error rendering profile:", error);
        this.showError("Error rendering profile data");
    }
},

renderOverviewTab() {
    this.renderPinnedRepos();
    this.renderContributionGraph();
    this.renderLanguageChart();
},

renderPinnedRepos() {
    const container = document.getElementById('pinned-repos-list');
    if (!container) return;
    
    const pinnedRepos = Array.isArray(this.state.repositories) ? this.state.repositories.slice(0, 6) : [];
    
    if (!pinnedRepos.length) {
        container.innerHTML = '<p>No repositories to display.</p>';
        return;
    }
    
    container.innerHTML = pinnedRepos.map(repo => {
        if (!repo) return '';
        return `
            <div class="pinned-item" data-repo-name="${repo.full_name || ''}">
                <h3><a href="${repo.html_url || '#'}" target="_blank">${repo.name || 'Unknown'}</a></h3>
                <p>${repo.description || ''}</p>
                <div class="repo-stats">
                    <span><span class="language-dot" style="background-color: ${this.getLanguageColor(repo.language)}"></span>${repo.language || 'N/A'}</span>
                    <span><i class="fas fa-star"></i> ${repo.stargazers_count || 0}</span>
                    <span><i class="fas fa-code-branch"></i> ${repo.forks_count || 0}</span>
                </div>
            </div>
        `;
    }).join('');
    
    // Add click event to pinned repos
    container.querySelectorAll('.pinned-item').forEach(item => {
        item.addEventListener('click', (e) => {
            if (!e.target.closest('a')) {
                const repoName = item.dataset.repoName;
                if (repoName) this.fetchAndShowReadme(repoName);
            }
        });
    });
},

renderContributionGraph() {
    const graph = document.getElementById('contribution-graph');
    if (!graph) return;
    
    graph.innerHTML = '';
    let totalContributions = 0;
    
    const contributions = Array.isArray(this.state.contributionData) ? this.state.contributionData : [];
    
    // Create 53 weeks of 7 days each
    for (let i = 0; i < 53; i++) {
        for (let j = 0; j < 7; j++) {
            const day = document.createElement('div');
            day.classList.add('contribution-day');
            
            const tooltip = document.createElement('div');
            tooltip.classList.add('tooltip');
            
            const dayIndex = i * 7 + j;
            const contribution = contributions[dayIndex] || { count: 0, level: 0 };
            
            day.style.backgroundColor = `var(--contrib-level-${contribution.level})`;
            
            const date = new Date();
            date.setDate(date.getDate() - (53 * 7 - (i * 7 + j)));
            
            tooltip.textContent = `${contribution.count} contributions on ${date.toLocaleDateString()}`;
            
            day.appendChild(tooltip);
            graph.appendChild(day);
            
            totalContributions += contribution.count;
        }
    }
    
    const contribCount = document.getElementById('contrib-count');
    if (contribCount) {
        contribCount.textContent = `${totalContributions} contributions in the last year`;
    }
},

renderLanguageChart() {
    const chartContainer = document.getElementById('language-breakdown');
    if (!chartContainer) return;
    
    const languages = {};
    const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
    
    repos.forEach(repo => {
        if (repo && repo.language) {
            languages[repo.language] = (languages[repo.language] || 0) + 1;
        }
    });
    
    const sortedLanguages = Object.entries(languages).sort((a, b) => b[1] - a[1]).slice(0, 5);
    const total = sortedLanguages.reduce((sum, [, count]) => sum + count, 0);

    if (sortedLanguages.length === 0) {
        chartContainer.innerHTML = '<p>No language data available.</p>';
        return;
    }
    
    chartContainer.innerHTML = sortedLanguages.map(([lang, count]) => {
        const percent = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
        return `
            <div class="language-bar">
                <div class="language-bar-name">${lang}</div>
                <div class="language-bar-container">
                    <div class="language-bar-fill" style="width: ${percent}%; background-color: ${this.getLanguageColor(lang)}"></div>
                </div>
                <div class="language-bar-percent">${percent}%</div>
            </div>
        `;
    }).join('');
},

renderRepositoriesTab() {
    this.sortRepositories();
    this.renderRepositories();
},

sortRepositories() {
    if (!Array.isArray(this.state.repositories)) return;
    
    const sortValue = this.elements.repoSort ? this.elements.repoSort.value : 'updated';
    this.state.repositories.sort((a, b) => {
        if (!a || !b) return 0;
        if (sortValue === 'name') return (a.name || '').localeCompare(b.name || '');
        if (sortValue === 'stars') return (b.stargazers_count || 0) - (a.stargazers_count || 0);
        return new Date(b.updated_at || 0) - new Date(a.updated_at || 0);
    });
},

filterAndRenderRepos() {
    const searchTerm = this.elements.repoSearch ? this.elements.repoSearch.value.toLowerCase() : '';
    const language = this.elements.repoLanguageFilter ? this.elements.repoLanguageFilter.value : '';

    const filtered = (this.state.repositories || []).filter(repo => {
        if (!repo) return false;
        const matchesSearch = (repo.name || '').toLowerCase().includes(searchTerm) || 
                              (repo.description || '').toLowerCase().includes(searchTerm);
        const matchesLanguage = !language || repo.language === language;
        return matchesSearch && matchesLanguage;
    });

    this.renderRepositories(filtered);
},

renderRepositories(reposToRender = null) {
    const container = this.elements.repoList;
    if (!container) return;
    
    const repos = reposToRender || (this.state.repositories || []);
    const start = (this.state.currentPage.repos - 1) * this.state.reposPerPage;
    const end = start + this.state.reposPerPage;
    const paginatedRepos = repos.slice(start, end);

    container.className = `repo-list-container ${this.state.repoView}-view`;
    container.innerHTML = paginatedRepos.map(repo => {
        if (!repo) return '';
        return `
            <div class="repo-item" data-repo-name="${repo.full_name || ''}">
                <h3><a href="${repo.html_url || '#'}" target="_blank">${repo.name || 'Unknown'}</a></h3>
                <p>${repo.description || ''}</p>
                <div class="repo-item-stats">
                    <span><span class="language-dot" style="background-color: ${this.getLanguageColor(repo.language)}"></span>${repo.language || 'N/A'}</span>
                    <span><i class="fas fa-star"></i> ${repo.stargazers_count || 0}</span>
                    <span><i class="fas fa-code-branch"></i> ${repo.forks_count || 0}</span>
                    <span>Updated on ${repo.updated_at ? new Date(repo.updated_at).toLocaleDateString() : 'Unknown'}</span>
                </div>
            </div>
        `;
    }).join('');

    // Add click event to repo items
    container.querySelectorAll('.repo-item').forEach(item => {
        item.addEventListener('click', (e) => {
            if (!e.target.closest('a')) {
                const repoName = item.dataset.repoName;
                if (repoName) this.fetchAndShowReadme(repoName);
            }
        });
    });

    this.renderPagination(repos.length, 'repos');
},

renderStarredTab() {
    this.sortStarred();
    this.renderStarred();
},

sortStarred() {
    if (!Array.isArray(this.state.starredRepos)) return;
    
    const sortValue = this.elements.starredSort ? this.elements.starredSort.value : 'starred_at';
    this.state.starredRepos.sort((a, b) => {
        if (!a || !b) return 0;
        if (sortValue === 'name') return (a.name || '').localeCompare(b.name || '');
        if (sortValue === 'stars') return (b.stargazers_count || 0) - (a.stargazers_count || 0);
        return new Date(b.starred_at || 0) - new Date(a.starred_at || 0);
    });
},

filterAndRenderStarred() {
    const searchTerm = this.elements.starredSearch ? this.elements.starredSearch.value.toLowerCase() : '';
    const language = this.elements.starredLanguageFilter ? this.elements.starredLanguageFilter.value : '';

    const filtered = (this.state.starredRepos || []).filter(repo => {
        if (!repo) return false;
        const matchesSearch = (repo.name || '').toLowerCase().includes(searchTerm) || 
                              (repo.description || '').toLowerCase().includes(searchTerm);
        const matchesLanguage = !language || repo.language === language;
        return matchesSearch && matchesLanguage;
    });

    this.renderStarred(filtered);
},

renderStarred(reposToRender = null) {
    const container = this.elements.starredList;
    if (!container) return;
    
    const repos = reposToRender || (this.state.starredRepos || []);
    const start = (this.state.currentPage.starred - 1) * this.state.reposPerPage;
    const end = start + this.state.reposPerPage;
    const paginatedRepos = repos.slice(start, end);

    container.className = `starred-list-container ${this.state.starredView}-view`;
    container.innerHTML = paginatedRepos.map(repo => {
        if (!repo) return '';
        return `
            <div class="starred-item" data-repo-name="${repo.full_name || ''}">
                <h3><a href="${repo.html_url || '#'}" target="_blank">${repo.name || 'Unknown'}</a></h3>
                <p>${repo.description || ''}</p>
                <div class="starred-item-stats">
                    <span><span class="language-dot" style="background-color: ${this.getLanguageColor(repo.language)}"></span>${repo.language || 'N/A'}</span>
                    <span><i class="fas fa-star"></i> ${repo.stargazers_count || 0}</span>
                    <span>Starred on ${repo.starred_at ? new Date(repo.starred_at).toLocaleDateString() : 'Unknown'}</span>
                </div>
            </div>
        `;
    }).join('');

    // Add click event to starred items
    container.querySelectorAll('.starred-item').forEach(item => {
        item.addEventListener('click', (e) => {
            if (!e.target.closest('a')) {
                const repoName = item.dataset.repoName;
                if (repoName) this.fetchAndShowReadme(repoName);
            }
        });
    });

    this.renderPagination(repos.length, 'starred');
},

renderActivityTab() {
    const feed = document.getElementById('activity-feed');
    if (!feed) return;
    
    const activities = Array.isArray(this.state.activityData) ? this.state.activityData : [];
    
    if (!activities.length) {
        feed.innerHTML = '<p>No recent public activity.</p>';
        return;
    }
    
    feed.innerHTML = activities.map(event => {
        if (!event) return '';
        const timeAgo = this.formatTimeAgo(new Date(event.created_at));
        let icon, text;
        switch (event.type) {
            case 'PushEvent':
                icon = 'fa-code-branch';
                text = `Pushed ${event.payload && event.payload.commits ? event.payload.commits.length : 0} commit(s) to ${event.repo ? event.repo.name : 'Unknown'}`;
                break;
            case 'WatchEvent':
                icon = 'fa-star';
                text = `Starred ${event.repo ? event.repo.name : 'Unknown'}`;
                break;
            case 'IssuesEvent':
                icon = 'fa-exclamation-circle';
                text = `${event.payload && event.payload.action ? event.payload.action : 'Performed'} an issue in ${event.repo ? event.repo.name : 'Unknown'}`;
                break;
            case 'PullRequestEvent':
                icon = 'fa-code-pull-request';
                text = `${event.payload && event.payload.action ? event.payload.action : 'Performed'} a pull request in ${event.repo ? event.repo.name : 'Unknown'}`;
                break;
            case 'CreateEvent':
                icon = 'fa-plus-square';
                text = `Created ${event.payload && event.payload.ref_type ? event.payload.ref_type : 'item'} ${event.payload && event.payload.ref ? event.payload.ref : ''} in ${event.repo ? event.repo.name : 'Unknown'}`;
                break;
            default:
                return '';
        }
        return `
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="activity-content">
                    <span>${text}</span>
                    <div class="activity-time">${timeAgo}</div>
                </div>
            </div>
        `;
    }).join('');
},

renderRepoHealthTab() {
    const metricsContainer = this.elements.healthMetrics;
    const recommendationsContainer = this.elements.healthRecommendations;
    
    if (!metricsContainer || !recommendationsContainer) return;
    
    const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
    const totalRepos = repos.length;
    const activeRepos = repos.filter(repo => {
        if (!repo || !repo.updated_at) return false;
        const lastUpdated = new Date(repo.updated_at);
        const threeMonthsAgo = new Date();
        threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
        return lastUpdated > threeMonthsAgo;
    }).length;
    
    const reposWithIssues = repos.filter(repo => repo && repo.open_issues_count > 0).length;
    const totalIssues = repos.reduce((total, repo) => total + (repo && repo.open_issues_count ? repo.open_issues_count : 0), 0);
    const avgIssuesPerRepo = totalRepos > 0 ? (totalIssues / totalRepos).toFixed(1) : 0;
    
    const reposWithLicense = repos.filter(repo => repo && repo.license).length;
    const forks = repos.reduce((total, repo) => total + (repo && repo.forks_count ? repo.forks_count : 0), 0);
    const watchers = repos.reduce((total, repo) => total + (repo && repo.watchers_count ? repo.watchers_count : 0), 0);
    
    // Render metrics
    metricsContainer.innerHTML = `
        <div class="health-metric">
            <div class="health-metric-value">${totalRepos}</div>
            <div class="health-metric-label">Total Repositories</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${activeRepos}</div>
            <div class="health-metric-label">Active Repositories</div>
            <div class="health-status ${activeRepos / totalRepos > 0.7 ? 'good' : activeRepos / totalRepos > 0.4 ? 'moderate' : 'poor'}">
                ${activeRepos / totalRepos > 0.7 ? 'Good' : activeRepos / totalRepos > 0.4 ? 'Moderate' : 'Needs Improvement'}
            </div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${avgIssuesPerRepo}</div>
            <div class="health-metric-label">Avg. Issues per Repo</div>
            <div class="health-status ${avgIssuesPerRepo < 5 ? 'good' : avgIssuesPerRepo < 15 ? 'moderate' : 'poor'}">
                ${avgIssuesPerRepo < 5 ? 'Good' : avgIssuesPerRepo < 15 ? 'Moderate' : 'High'}
            </div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${totalRepos > 0 ? Math.round(reposWithLicense / totalRepos * 100) : 0}%</div>
            <div class="health-metric-label">Repos with License</div>
            <div class="health-status ${totalRepos > 0 && reposWithLicense / totalRepos > 0.8 ? 'good' : totalRepos > 0 && reposWithLicense / totalRepos > 0.5 ? 'moderate' : 'poor'}">
                ${totalRepos > 0 && reposWithLicense / totalRepos > 0.8 ? 'Good' : totalRepos > 0 && reposWithLicense / totalRepos > 0.5 ? 'Moderate' : 'Needs Improvement'}
            </div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${forks}</div>
            <div class="health-metric-label">Total Forks</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${watchers}</div>
            <div class="health-metric-label">Total Watchers</div>
        </div>
    `;
    
    // Generate recommendations
    const recommendations = [];
    
    if (totalRepos > 0 && activeRepos / totalRepos < 0.5) {
        recommendations.push("Consider updating or archiving inactive repositories to improve your profile's health score.");
    }
    
    if (avgIssuesPerRepo > 10) {
        recommendations.push("You have a high number of open issues. Consider addressing them to improve repository health.");
    }
    
    if (totalRepos > 0 && reposWithLicense / totalRepos < 0.5) {
        recommendations.push("Add licenses to your repositories to make them more accessible to other developers.");
    }
    
    if (recommendations.length === 0) {
        recommendations.push("Your repository health looks good! Keep up the great work.");
    }
    
    recommendationsContainer.innerHTML = `
        <h3>Recommendations</h3>
        <ul>
            ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
        </ul>
    `;
},

renderContributionStreakTab() {
    const currentStreakEl = this.elements.currentStreak;
    const longestStreakEl = this.elements.longestStreak;
    const calendarEl = this.elements.streakCalendar;
    
    if (!currentStreakEl || !longestStreakEl || !calendarEl) return;
    
    const streak = this.state.streakData || { current: 0, longest: 0, contributions: [] };
    
    // Update streak values
    currentStreakEl.textContent = streak.current;
    longestStreakEl.textContent = streak.longest;
    
    // Render streak calendar
    calendarEl.innerHTML = '';
    
    // Get the last 30 days
    const today = new Date();
    for (let i = 29; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        
        const day = document.createElement('div');
        day.classList.add('streak-day');
        
        // Check if there was a contribution on this day
        const dateStr = date.toISOString().split('T')[0];
        const contribution = streak.contributions.find(c => c && c.date === dateStr);
        
        if (contribution && contribution.count > 0) {
            day.classList.add('active');
            day.title = `${contribution.count} contributions on ${date.toLocaleDateString()}`;
        } else {
            day.title = `No contributions on ${date.toLocaleDateString()}`;
        }
        
        calendarEl.appendChild(day);
    }
},

renderActivityHeatmapTab() {
    const container = this.elements.heatmapContainer;
    if (!container) return;
    
    container.innerHTML = '';
    
    // Render heatmap
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const heatmapData = this.state.heatmapData || Array(7).fill().map(() => Array(24).fill(0));
    
    for (let day = 0; day < 7; day++) {
        for (let hour = 0; hour < 24; hour++) {
            const cell = document.createElement('div');
            cell.classList.add('heatmap-hour');
            
            // Set background color based on activity level
            const activityLevel = heatmapData[day] && heatmapData[day][hour] !== undefined ? heatmapData[day][hour] : 0;
            const opacity = Math.max(0.1, activityLevel);
            cell.style.backgroundColor = `var(--color-accent-fg)`;
            cell.style.opacity = opacity;
            
            cell.title = `${days[day]} ${hour}:00 - ${Math.round(activityLevel * 100)}% activity`;
            
            container.appendChild(cell);
        }
    }
},

renderFollowerGrowthTab() {
    const canvas = this.elements.growthCanvas;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    // Get data
    const { months, followers } = this.state.followerGrowthData || { months: [], followers: [] };
    
    if (months.length === 0 || followers.length === 0) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('No follower growth data available', canvas.width / 2, canvas.height / 2);
        return;
    }
    
    // Create chart
    try {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Followers',
                    data: followers,
                    backgroundColor: 'rgba(9, 105, 218, 0.2)',
                    borderColor: 'rgba(9, 105, 218, 1)',
                    borderWidth: 2,
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    } catch (error) {
        console.error("Error creating follower growth chart:", error);
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Error loading follower growth data', canvas.width / 2, canvas.height / 2);
    }
},

renderSkillsRadarTab() {
    const canvas = this.elements.skillsRadarCanvas;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    const skillsData = this.state.skillsData || [];
    
    if (skillsData.length === 0) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('No skills data available', canvas.width / 2, canvas.height / 2);
        return;
    }
    
    // Create radar chart
    try {
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: skillsData.map(skill => skill.skill),
                datasets: [{
                    label: 'Skill Level',
                    data: skillsData.map(skill => skill.value),
                    backgroundColor: 'rgba(9, 105, 218, 0.2)',
                    borderColor: 'rgba(9, 105, 218, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(9, 105, 218, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(9, 105, 218, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    } catch (error) {
        console.error("Error creating skills radar chart:", error);
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Error loading skills data', canvas.width / 2, canvas.height / 2);
    }
},

renderProjectTimelineTab() {
    const container = this.elements.timelineContainer;
    if (!container) return;
    
    const timelineData = this.state.timelineData || [];
    
    if (timelineData.length === 0) {
        container.innerHTML = '<p>No project timeline data available.</p>';
        return;
    }
    
    container.innerHTML = timelineData.map(item => `
        <div class="timeline-item">
            <div class="timeline-date">${item.date}</div>
            <div class="timeline-title">${item.title}</div>
            <div class="timeline-description">${item.description}</div>
            <div class="timeline-language">
                <span class="language-dot" style="background-color: ${this.getLanguageColor(item.language)}"></span>
                ${item.language}
            </div>
        </div>
    `).join('');
},

renderCollaborationNetworkTab() {
    const container = document.getElementById('network-container');
    if (!container) return;
    
    // Clear previous content
    container.innerHTML = '';
    
    const { nodes, links } = this.state.collaborationData;
    
    if (nodes.length === 0) {
        container.innerHTML = '<p>No collaboration data available.</p>';
        return;
    }
    
    // Create SVG for network visualization
    const svg = d3.select('#network-container')
        .append('svg')
        .attr('width', '100%')
        .attr('height', '100%');
    
    const width = container.offsetWidth;
    const height = 400;
    
    svg.attr('viewBox', [0, 0, width, height]);
    
    // Create simulation
    const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(50))
        .force('charge', d3.forceManyBody().strength(-100))
        .force('center', d3.forceCenter(width / 2, height / 2));
    
    // Create links
    const link = svg.append('g')
        .selectAll('line')
        .data(links)
        .enter().append('line')
        .attr('stroke', '#999')
        .attr('stroke-opacity', 0.6)
        .attr('stroke-width', d => Math.sqrt(d.value));
    
    // Create nodes
    const node = svg.append('g')
        .selectAll('circle')
        .data(nodes)
        .enter().append('circle')
        .attr('r', d => d.size || 5)
        .attr('fill', d => {
            if (d.group === 1) return '#0969da'; // User
            if (d.group === 2) return '#1a7f37'; // Repository
            return '#9a6700'; // Collaborator
        })
        .call(d3.drag()
            .on('start', dragstarted)
            .on('drag', dragged)
            .on('end', dragended));
    
    // Add labels
    const label = svg.append('g')
        .selectAll('text')
        .data(nodes)
        .enter().append('text')
        .text(d => d.name)
        .attr('font-size', '12px')
        .attr('dx', 12)
        .attr('dy', 4);
    
    // Update positions on simulation tick
    simulation.on('tick', () => {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);
        
        node
            .attr('cx', d => d.x)
            .attr('cy', d => d.y);
        
        label
            .attr('x', d => d.x)
            .attr('y', d => d.y);
    });
    
    // Drag functions
    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
},

renderAchievementsTab() {
    const container = this.elements.achievementsContainer;
    if (!container) return;
    
    const achievements = this.state.achievements || [];
    
    if (achievements.length === 0) {
        container.innerHTML = '<p>No achievements available.</p>';
        return;
    }
    
    container.innerHTML = achievements.map(achievement => `
        <div class="achievement ${achievement.unlocked ? '' : 'locked'}">
            <div class="achievement-icon">
                <i class="fas ${achievement.icon}"></i>
            </div>
            <div class="achievement-name">${achievement.name}</div>
            <div class="achievement-description">${achievement.description}</div>
        </div>
    `).join('');
},

renderProductivityScoreTab() {
    // This is handled in calculateProductivityScore method
    // which is called when the profile is rendered
},

renderCodeQualityTab() {
    const metricsContainer = this.elements.codeQualityMetrics;
    const recommendationsContainer = this.elements.codeQualityRecommendations;
    
    if (!metricsContainer || !recommendationsContainer) return;
    
    const metrics = this.state.codeQualityMetrics;
    
    if (!metrics || Object.keys(metrics).length === 0) {
        metricsContainer.innerHTML = '<p>No code quality data available.</p>';
        recommendationsContainer.innerHTML = '';
        return;
    }
    
    // Render metrics
    metricsContainer.innerHTML = `
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalCommits || 0}</div>
            <div class="health-metric-label">Total Commits</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalIssues || 0}</div>
            <div class="health-metric-label">Open Issues</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalPullRequests || 0}</div>
            <div class="health-metric-label">Pull Requests</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalReleases || 0}</div>
            <div class="health-metric-label">Releases</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.avgCommitMessageLength || 0}</div>
            <div class="health-metric-label">Avg. Commit Message Length</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.avgCodeCoverage || 0}%</div>
            <div class="health-metric-label">Avg. Code Coverage</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.technicalDebt || 0}</div>
            <div class="health-metric-label">Technical Debt</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.documentationQuality || 0}%</div>
            <div class="health-metric-label">Documentation Quality</div>
        </div>
    `;
    
    // Generate recommendations
    const recommendations = [];
    
    if (metrics.avgCommitMessageLength < 20) {
        recommendations.push("Consider writing more descriptive commit messages to improve code quality.");
    }
    
    if (metrics.avgCodeCoverage < 70) {
        recommendations.push("Increase code coverage to improve code quality and reliability.");
    }
    
    if (metrics.technicalDebt > 50) {
        recommendations.push("Address technical debt to improve maintainability and performance.");
    }
    
    if (metrics.documentationQuality < 70) {
        recommendations.push("Improve documentation to make your code more accessible to others.");
    }
    
    if (recommendations.length === 0) {
        recommendations.push("Your code quality looks good! Keep up the great work.");
    }
    
    recommendationsContainer.innerHTML = `
        <h3>Recommendations</h3>
        <ul>
            ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
        </ul>
    `;
},

renderSocialInfluenceTab() {
    const metricsContainer = this.elements.socialInfluenceMetrics;
    const recommendationsContainer = this.elements.socialInfluenceRecommendations;
    
    if (!metricsContainer || !recommendationsContainer) return;
    
    const metrics = this.state.socialInfluenceMetrics;
    
    if (!metrics || Object.keys(metrics).length === 0) {
        metricsContainer.innerHTML = '<p>No social influence data available.</p>';
        recommendationsContainer.innerHTML = '';
        return;
    }
    
    // Render metrics
    metricsContainer.innerHTML = `
        <div class="health-metric">
            <div class="health-metric-value">${metrics.followers || 0}</div>
            <div class="health-metric-label">Followers</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.following || 0}</div>
            <div class="health-metric-label">Following</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalStars || 0}</div>
            <div class="health-metric-label">Total Stars</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalForks || 0}</div>
            <div class="health-metric-label">Total Forks</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.totalWatchers || 0}</div>
            <div class="health-metric-label">Total Watchers</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.followerToFollowingRatio || 0}</div>
            <div class="health-metric-label">Follower/Following Ratio</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.starToForkRatio || 0}</div>
            <div class="health-metric-label">Star/Fork Ratio</div>
        </div>
        <div class="health-metric">
            <div class="health-metric-value">${metrics.influenceScore || 0}</div>
            <div class="health-metric-label">Influence Score</div>
        </div>
    `;
    
    // Generate recommendations
    const recommendations = [];
    
    if (metrics.followers < 50) {
        recommendations.push("Engage more with the community to increase your followers.");
    }
    
    if (metrics.followerToFollowingRatio < 1) {
        recommendations.push("You're following more people than are following you. Consider unfollowing inactive accounts.");
    }
    
    if (metrics.totalStars < 100) {
        recommendations.push("Contribute to high-quality projects to increase your stars.");
    }
    
    if (recommendations.length === 0) {
        recommendations.push("Your social influence looks good! Keep up the great work.");
    }
    
    recommendationsContainer.innerHTML = `
        <h3>Recommendations</h3>
        <ul>
            ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
        </ul>
    `;
},

renderActivityPatternsTab() {
    const canvas = this.elements.activityPatternsCanvas;
    const insightsContainer = this.elements.activityPatternsInsights;
    
    if (!canvas || !insightsContainer) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    const data = this.state.activityPatternsData;
    
    if (!data || !data.dayOfWeekActivity || !data.hourOfDayActivity) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('No activity patterns data available', canvas.width / 2, canvas.height / 2);
        insightsContainer.innerHTML = '';
        return;
    }
    
    // Create chart
    try {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                datasets: [{
                    label: 'Activity by Day of Week',
                    data: data.dayOfWeekActivity,
                    backgroundColor: 'rgba(9, 105, 218, 0.5)',
                    borderColor: 'rgba(9, 105, 218, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        // Generate insights
        const insights = [];
        insights.push(`You're most active on ${data.mostActiveDay}.`);
        insights.push(`Your peak activity hour is around ${data.mostActiveHour}:00.`);
        
        insightsContainer.innerHTML = `
            <h3>Activity Insights</h3>
            <ul>
                ${insights.map(insight => `<li>${insight}</li>`).join('')}
            </ul>
        `;
    } catch (error) {
        console.error("Error creating activity patterns chart:", error);
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Error loading activity patterns data', canvas.width / 2, canvas.height / 2);
    }
},

renderProjectDiversityTab() {
    const canvas = this.elements.projectDiversityCanvas;
    const insightsContainer = this.elements.projectDiversityInsights;
    
    if (!canvas || !insightsContainer) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    const data = this.state.projectDiversityData;
    
    if (!data || !data.languageBreakdown) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('No project diversity data available', canvas.width / 2, canvas.height / 2);
        insightsContainer.innerHTML = '';
        return;
    }
    
    // Create chart
    try {
        const languages = Object.keys(data.languageBreakdown);
        const counts = Object.values(data.languageBreakdown);
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: languages,
                datasets: [{
                    data: counts,
                    backgroundColor: [
                        '#f1e05a', // JavaScript
                        '#3572A5', // Python
                        '#f34b7d', // C++
                        '#e34c26', // HTML
                        '#563d7c', // CSS
                        '#239120', // C#
                        '#b07219', // Java
                        '#2b7489', // TypeScript
                        '#00ADD8', // Go
                        '#dea584', // Rust
                        '#4F5D95', // PHP
                        '#701516', // Ruby
                        '#ffac45'  // Swift
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
        
        // Generate insights
        const insights = [];
        insights.push(`You've worked with ${data.languageCount} different programming languages.`);
        insights.push(`Your projects cover ${data.topicCount} different topics.`);
        insights.push(`Your average repository size is ${data.avgRepoSize} KB.`);
        insights.push(`Your project diversity score is ${data.diversityScore}.`);
        
        insightsContainer.innerHTML = `
            <h3>Project Diversity Insights</h3>
            <ul>
                ${insights.map(insight => `<li>${insight}</li>`).join('')}
            </ul>
        `;
    } catch (error) {
        console.error("Error creating project diversity chart:", error);
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Error loading project diversity data', canvas.width / 2, canvas.height / 2);
    }
},

renderTimezoneAnalysisTab() {
    const canvas = this.elements.timezoneCanvas;
    const insightsContainer = this.elements.timezoneInsights;
    
    if (!canvas || !insightsContainer) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    const data = this.state.timezoneData;
    
    if (!data || !data.activityByTimezone) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('No timezone data available', canvas.width / 2, canvas.height / 2);
        insightsContainer.innerHTML = '';
        return;
    }
    
    // Create chart
    try {
        const timezones = Object.keys(data.activityByTimezone);
        const activities = Object.values(data.activityByTimezone);
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: timezones.map(tz => this.getTimezoneName(parseInt(tz))),
                datasets: [{
                    label: 'Activity by Timezone',
                    data: activities,
                    backgroundColor: 'rgba(9, 105, 218, 0.5)',
                    borderColor: 'rgba(9, 105, 218, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        // Generate insights
        const insights = [];
        insights.push(`Your most likely timezone is ${data.timezoneName}.`);
        
        insightsContainer.innerHTML = `
            <h3>Timezone Insights</h3>
            <ul>
                ${insights.map(insight => `<li>${insight}</li>`).join('')}
            </ul>
        `;
    } catch (error) {
        console.error("Error creating timezone analysis chart:", error);
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Error loading timezone data', canvas.width / 2, canvas.height / 2);
    }
},

async askAI() {
    const query = this.elements.aiQueryInput ? this.elements.aiQueryInput.value.trim() : '';
    if (!query) return this.showError("Please enter a question for the AI.");

    const responseEl = this.elements.aiResponse;
    if (responseEl) {
        responseEl.style.display = 'block';
        responseEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI is thinking...';
    }

    const context = `
        Profile: ${JSON.stringify(this.state.profileData, null, 2)}
        Top Repositories: ${JSON.stringify((this.state.repositories || []).slice(0, 5).map(r => ({ 
            name: r && r.name, 
            lang: r && r.language, 
            stars: r && r.stargazers_count, 
            desc: r && r.description 
        })), null, 2)}
        Contribution Streak: ${(this.state.streakData && this.state.streakData.current) || 0} days (Longest: ${(this.state.streakData && this.state.streakData.longest) || 0} days)
    `;
    
    try {
        // Simulate AI response since we can't use the real API without a proxy
        setTimeout(() => {
            if (responseEl) {
                responseEl.innerHTML = `
                    <h3>Simulated AI Response</h3>
                    <p>I apologize, but I couldn't connect to the AI service. Here's a simulated response based on your query:</p>
                    <p>Based on the profile data, this developer appears to be ${(this.state.profileData && this.state.profileData.followers > 100) ? 'well-established' : 'emerging'} in the GitHub community with ${(this.state.profileData && this.state.profileData.public_repos) || 0} public repositories.</p>
                    <p>Their primary programming languages appear to be ${Object.keys(this.getLanguageBreakdown()).slice(0, 3).join(', ')}.</p>
                    <p>They have maintained a contribution streak of ${(this.state.streakData && this.state.streakData.current) || 0} days, with their longest streak being ${(this.state.streakData && this.state.streakData.longest) || 0} days.</p>
                `;
            }
        }, 1500);
    } catch (error) {
        if (responseEl) {
            responseEl.innerHTML = `<p>Error: ${error.message}</p>`;
        }
    }
},

async handleCompare() {
    const username1 = this.elements.usernameInput ? this.elements.usernameInput.value.trim() : '';
    const username2 = this.elements.compareUsernameInput ? this.elements.compareUsernameInput.value.trim() : '';
    
    if (!username1 || !username2) return this.showError("Please enter both usernames to compare.");

    this.showLoading();
    try {
        const [user1, user2] = await Promise.all([
            this.fetchJSON(`https://api.github.com/users/${username1}`),
            this.fetchJSON(`https://api.github.com/users/${username2}`)
        ]);
        
        if (!user1 || !user2) throw new Error("One or both users not found.");
        
        // Fetch additional data for comparison
        const [user1Repos, user2Repos] = await Promise.all([
            this.fetchJSON(`https://api.github.com/users/${username1}/repos?per_page=100`),
            this.fetchJSON(`https://api.github.com/users/${username2}/repos?per_page=100`)
        ]);
        
        // Calculate additional metrics
        user1.totalStars = (user1Repos || []).reduce((total, repo) => total + (repo && repo.stargazers_count ? repo.stargazers_count : 0), 0);
        user2.totalStars = (user2Repos || []).reduce((total, repo) => total + (repo && repo.stargazers_count ? repo.stargazers_count : 0), 0);
        
        user1.totalForks = (user1Repos || []).reduce((total, repo) => total + (repo && repo.forks_count ? repo.forks_count : 0), 0);
        user2.totalForks = (user2Repos || []).reduce((total, repo) => total + (repo && repo.forks_count ? repo.forks_count : 0), 0);
        
        user1.avgRepoSize = (user1Repos || []).reduce((total, repo) => total + (repo && repo.size ? repo.size : 0), 0) / (user1Repos || []).length;
        user2.avgRepoSize = (user2Repos || []).reduce((total, repo) => total + (repo && repo.size ? repo.size : 0), 0) / (user2Repos || []).length;
        
        this.renderComparison(user1, user2);
        if (this.elements.comparisonResults) {
            this.elements.comparisonResults.style.display = 'block';
        }
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    } catch (error) {
        this.showError(error.message);
    } finally {
        this.hideLoading();
    }
},

renderComparison(user1, user2) {
    const table = document.getElementById('comparison-table');
    if (!table) return;
    
    const fields = [
        { key: 'name', label: 'Name' },
        { key: 'login', label: 'Username' },
        { key: 'public_repos', label: 'Public Repos' },
        { key: 'followers', label: 'Followers' },
        { key: 'following', label: 'Following' },
        { key: 'totalStars', label: 'Total Stars' },
        { key: 'totalForks', label: 'Total Forks' },
        { key: 'avgRepoSize', label: 'Avg. Repo Size (KB)', format: (val) => Math.round(val) },
        { key: 'created_at', label: 'Account Created', format: (val) => new Date(val).toLocaleDateString() }
    ];
    
    table.innerHTML = `
        <thead>
            <tr><th>Metric</th><th>${user1.login || 'User 1'}</th><th>${user2.login || 'User 2'}</th><th>Winner</th></tr>
        </thead>
        <tbody>
            ${fields.map(field => {
                const val1 = field.format ? field.format(user1[field.key]) : (user1[field.key] || 'N/A');
                const val2 = field.format ? field.format(user2[field.key]) : (user2[field.key] || 'N/A');
                
                let winner = '';
                if (field.key === 'created_at') {
                    winner = new Date(user1[field.key]) < new Date(user2[field.key]) ? user1.login : user2.login;
                } else if (typeof user1[field.key] === 'number' && typeof user2[field.key] === 'number') {
                    winner = user1[field.key] > user2[field.key] ? user1.login : user2.login;
                }
                
                return `
                    <tr>
                        <td><strong>${field.label}</strong></td>
                        <td>${val1}</td>
                        <td>${val2}</td>
                        <td>${winner ? `<strong>${winner}</strong>` : 'Tie'}</td>
                    </tr>
                `;
            }).join('')}
        </tbody>
    `;
},

// --- README Modal --- 
async fetchAndShowReadme(repoFullName) {
    if (!this.elements.readmeModal || !this.elements.readmeTitle || !this.elements.readmeBody) return;
    
    this.elements.readmeModal.style.display = 'block';
    this.elements.readmeBody.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading README...';

    try {
        const repoData = await this.fetchJSON(`https://api.github.com/repos/${repoFullName}`);
        if (!repoData) throw new Error("Repository not found.");
        
        const defaultBranch = repoData.default_branch || 'main';

        let readmeData = await this.fetchJSON(`https://api.github.com/repos/${repoFullName}/readme`);
        if (!readmeData) {
            throw new Error("No README found.");
        }
        
        const content = atob(readmeData.content.replace(/\n/g, ''));
        
        this.elements.readmeTitle.textContent = `README of ${repoFullName}`;
        this.elements.readmeBody.innerHTML = marked.parse(content);
        
    } catch (error) {
        this.elements.readmeBody.innerHTML = `<p>Could not load README. ${error.message}</p>`;
    }
},

// --- Export Functions ---
exportToPDF() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(20);
        doc.text(`GitHub Profile: ${(this.state.profileData && this.state.profileData.login) || 'Unknown'}`, 20, 20);
        
        doc.setFontSize(12);
        doc.text(`Name: ${(this.state.profileData && this.state.profileData.name) || 'N/A'}`, 20, 30);
        doc.text(`Bio: ${(this.state.profileData && this.state.profileData.bio) || 'N/A'}`, 20, 40);
        doc.text(`Location: ${(this.state.profileData && this.state.profileData.location) || 'N/A'}`, 20, 50);
        doc.text(`Company: ${(this.state.profileData && this.state.profileData.company) || 'N/A'}`, 20, 60);
        doc.text(`Followers: ${(this.state.profileData && this.state.profileData.followers) || 0}`, 20, 70);
        doc.text(`Following: ${(this.state.profileData && this.state.profileData.following) || 0}`, 20, 80);
        doc.text(`Public Repos: ${(this.state.profileData && this.state.profileData.public_repos) || 0}`, 20, 90);
        
        doc.setFontSize(16);
        doc.text('Top Repositories:', 20, 110);
        
        doc.setFontSize(12);
        const topRepos = (this.state.repositories || []).slice(0, 5);
        topRepos.forEach((repo, index) => {
            const y = 120 + (index * 10);
            doc.text(`${(repo && repo.name) || 'Unknown'} (${(repo && repo.stargazers_count) || 0} stars)`, 20, y);
        });
        
        doc.save(`${(this.state.profileData && this.state.profileData.login) || 'profile'}_profile.pdf`);
    } catch (error) {
        this.showError(`Error exporting PDF: ${error.message}`);
    }
},

exportToJSON() {
    try {
        const profileData = {
            profile: this.state.profileData,
            repositories: this.state.repositories,
            starred: this.state.starredRepos,
            activity: this.state.activityData,
            streak: this.state.streakData,
            skills: this.state.skillsData,
            achievements: this.state.achievements,
            productivityScore: this.state.productivityScore
        };
        
        const dataStr = JSON.stringify(profileData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `${(this.state.profileData && this.state.profileData.login) || 'profile'}_profile.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    } catch (error) {
        this.showError(`Error exporting JSON: ${error.message}`);
    }
},

exportToCSV() {
    try {
        const repos = this.state.repositories || [];
        if (!repos.length) {
            this.showError("No repository data to export.");
            return;
        }

        const headers = ['Name', 'Description', 'Language', 'Stars', 'Forks', 'Created At', 'Updated At'];
        const csvContent = [
            headers.join(','),
            ...repos.map(repo => [
                repo.name || '',
                `"${(repo.description || '').replace(/"/g, '""')}"`, // Escape quotes in description
                repo.language || '',
                repo.stargazers_count || 0,
                repo.forks_count || 0,
                repo.created_at || '',
                repo.updated_at || ''
            ].join(','))
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `${(this.state.profileData && this.state.profileData.login) || 'profile'}_repositories.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        this.showError(`Error exporting CSV: ${error.message}`);
    }
},

exportToImage() {
    try {
        const profileWrapper = document.getElementById('profile-wrapper');
        if (!profileWrapper) return;

        // Use html2canvas to capture the profile
        html2canvas(profileWrapper, {
            backgroundColor: getComputedStyle(document.body).getPropertyValue('--color-canvas-default'),
            scale: 2 // Higher resolution
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `${(this.state.profileData && this.state.profileData.login) || 'profile'}_analysis.png`;
            link.href = canvas.toDataURL();
            link.click();
        }).catch(error => {
            console.error("Error exporting image:", error);
            this.showError(`Error exporting image: ${error.message}`);
        });
    } catch (error) {
        this.showError(`Error exporting image: ${error.message}`);
    }
},

// --- Helper Functions ---
async fetchJSON(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
        return response.json();
    } catch (error) {
        console.error(`Error fetching ${url}:`, error);
        throw error;
    }
},

getLanguageColor(language) {
    const colors = { 
        JavaScript: '#f1e05a', 
        Python: '#3572A5', 
        'C++': '#f34b7d', 
        HTML: '#e34c26', 
        CSS: '#563d7c', 
        'C#': '#239120', 
        Java: '#b07219',
        TypeScript: '#2b7489',
        Go: '#00ADD8',
        Rust: '#dea584',
        PHP: '#4F5D95',
        Ruby: '#701516',
        Swift: '#ffac45'
    };
    return colors[language] || '#cccccc';
},

getLanguageBreakdown() {
    const languages = {};
    const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
    
    repos.forEach(repo => {
        if (repo && repo.language) {
            languages[repo.language] = (languages[repo.language] || 0) + 1;
        }
    });
    return languages;
},

formatTimeAgo(date) {
    if (!date) return 'Unknown time';
    
    const seconds = Math.floor((new Date() - date) / 1000);
    if (seconds < 60) return 'just now';
    
    const intervals = { year: 31536000, month: 2592000, day: 86400, hour: 3600, minute: 60 };
    for (const [unit, secondsInUnit] of Object.entries(intervals)) {
        const interval = Math.floor(seconds / secondsInUnit);
        if (interval >= 1) return `${interval} ${unit}${interval > 1 ? 's' : ''} ago`;
    }
    return 'some time ago';
},

getDayName(dayIndex) {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    return days[dayIndex] || 'Unknown';
},

getTimezoneName(offset) {
    // This is a simplified mapping
    const timezones = {
        '-720': 'UTC-12',
        '-660': 'UTC-11',
        '-600': 'UTC-10',
        '-540': 'UTC-9',
        '-480': 'UTC-8',
        '-420': 'UTC-7',
        '-360': 'UTC-6',
        '-300': 'UTC-5',
        '-240': 'UTC-4',
        '-180': 'UTC-3',
        '-120': 'UTC-2',
        '-60': 'UTC-1',
        '0': 'UTC',
        '60': 'UTC+1',
        '120': 'UTC+2',
        '180': 'UTC+3',
        '240': 'UTC+4',
        '300': 'UTC+5',
        '360': 'UTC+6',
        '420': 'UTC+7',
        '480': 'UTC+8',
        '540': 'UTC+9',
        '600': 'UTC+10',
        '660': 'UTC+11',
        '720': 'UTC+12'
    };
    return timezones[offset] || `UTC${offset >= 0 ? '+' : ''}${offset / 60}`;
},

switchTab(tabName) {
    this.state.currentTab = tabName;
    
    this.elements.tabNav.forEach(tab => {
        if (tab && tab.dataset) {
            tab.classList.toggle('active', tab.dataset.tab === tabName);
        }
    });
    
    this.elements.tabPanes.forEach(pane => {
        if (pane && pane.id) {
            pane.classList.toggle('active', pane.id === tabName);
        }
    });
    
    // Special handling for tabs that need to be rendered on demand
    if (tabName === 'follower-growth' && (!this.state.followerGrowthData || !this.state.followerGrowthData.months || this.state.followerGrowthData.months.length === 0)) {
        this.generateFollowerGrowthData();
        this.renderFollowerGrowthTab();
    }
},

setRepoView(view) {
    this.state.repoView = view;
    if (this.elements.listViewBtn) {
        this.elements.listViewBtn.classList.toggle('active', view === 'list');
    }
    if (this.elements.gridViewBtn) {
        this.elements.gridViewBtn.classList.toggle('active', view === 'grid');
    }
    this.renderRepositories();
},

toggleCompareMode() {
    if (!this.elements.compareSection) return;
    
    const isVisible = this.elements.compareSection.style.display !== 'none';
    this.elements.compareSection.style.display = isVisible ? 'none' : 'flex';
    
    if (this.elements.compareUsernameInput) {
        this.elements.compareUsernameInput.value = '';
    }
    if (this.elements.comparisonResults) {
        this.elements.comparisonResults.style.display = 'none';
    }
},

toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark);
    if (this.elements.themeToggle) {
        this.elements.themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
},

loadTheme() {
    const isDark = localStorage.getItem('darkMode') === 'true';
    if (isDark) {
        document.body.classList.add('dark-mode');
        if (this.elements.themeToggle) {
            this.elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
    }
},

addToSearchHistory(username) {
    if (!username || !this.state.searchHistory) return;
    
    if (!this.state.searchHistory.includes(username)) {
        this.state.searchHistory.unshift(username);
        this.state.searchHistory = this.state.searchHistory.slice(0, 5);
        localStorage.setItem('searchHistory', JSON.stringify(this.state.searchHistory));
        this.renderSearchHistory();
    }
},

renderSearchHistory() {
    const historyContainer = document.getElementById('search-history');
    if (!historyContainer || !this.state.searchHistory) return;
    
    historyContainer.innerHTML = this.state.searchHistory.map(user => 
        `<span class="history-item" onclick="App.elements.usernameInput.value='${user}'; App.handleSearch();"><i class="fas fa-history"></i>${user}</span>`
    ).join('');
},

renderPagination(totalItems, type) {
    const totalPages = Math.ceil(totalItems / this.state.reposPerPage);
    const paginationContainer = type === 'repos' ? 
        this.elements.repoPagination : 
        this.elements.starredPagination;
    
    if (!paginationContainer) return;
    
    paginationContainer.innerHTML = '';

    if (totalPages <= 1) return;

    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.classList.toggle('active', i === this.state.currentPage[type]);
        btn.addEventListener('click', () => {
            this.state.currentPage[type] = i;
            if (type === 'repos') {
                this.filterAndRenderRepos();
            } else {
                this.filterAndRenderStarred();
            }
        });
        paginationContainer.appendChild(btn);
    }
},

populateLanguageFilter() {
    if (!this.elements.repoLanguageFilter) return;
    
    const languages = new Set();
    const repos = Array.isArray(this.state.repositories) ? this.state.repositories : [];
    
    repos.forEach(repo => {
        if (repo && repo.language) {
            languages.add(repo.language);
        }
    });
    
    const currentValue = this.elements.repoLanguageFilter.value;
    this.elements.repoLanguageFilter.innerHTML = '<option value="">Language: All</option>';
    
    Array.from(languages).sort().forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang;
        this.elements.repoLanguageFilter.appendChild(option);
    });
    
    this.elements.repoLanguageFilter.value = currentValue;
},

populateStarredLanguageFilter() {
    if (!this.elements.starredLanguageFilter) return;
    
    const languages = new Set();
    const repos = Array.isArray(this.state.starredRepos) ? this.state.starredRepos : [];
    
    repos.forEach(repo => {
        if (repo && repo.language) {
            languages.add(repo.language);
        }
    });
    
    const currentValue = this.elements.starredLanguageFilter.value;
    this.elements.starredLanguageFilter.innerHTML = '<option value="">Language: All</option>';
    
    Array.from(languages).sort().forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang;
        this.elements.starredLanguageFilter.appendChild(option);
    });
    
    this.elements.starredLanguageFilter.value = currentValue;
},

showLoading() { 
    if (this.elements.loadingContainer) {
        this.elements.loadingContainer.style.display = 'block'; 
    }
},
hideLoading() { 
    if (this.elements.loadingContainer) {
        this.elements.loadingContainer.style.display = 'none'; 
    }
},
showResults() { 
    if (this.elements.profileWrapper) {
        this.elements.profileWrapper.style.display = 'block'; 
    }
},
hideResults() { 
    if (this.elements.profileWrapper) {
        this.elements.profileWrapper.style.display = 'none'; 
    }
},
showError(message) {
    if (this.elements.errorContainer) {
        this.elements.errorContainer.textContent = message;
        this.elements.errorContainer.style.display = 'block';
    }
    this.hideLoading();
},
clearErrors() { 
    if (this.elements.errorContainer) {
        this.elements.errorContainer.style.display = 'none'; 
    }
}
};

App.init();
});
</script>
</body>
</html>
